<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zzb.extra.entity">
    <!-- INSBMarketActivity -->
    <select id="INSBMarketActivity_insert" parameterType="com.zzb.extra.entity.INSBMarketActivity" resultType="int">
		insert into INSBMarketActivity
		(id,operator,createtime,modifytime,noti,activityname,activitytype,limited,effectivetime,terminaltime,status,activitycode,tmpcode) 
		values
		(#{id},#{operator},#{createtime},#{modifytime},#{noti},#{activityname},#{activitytype},#{limited},#{effectivetime},#{terminaltime},#{status},#{activitycode},#{tmpcode}) 
	</select>
    <select id="queryActivityList" parameterType="Map" resultType="Map">
       	select id,activityname,activitytype,limited,status,IFNULL(noti,'') AS noti,tmpcode,activitycode,
        date_format(effectivetime,'%Y-%m-%d') AS effectivetime,
        date_format(terminaltime,'%Y-%m-%d') AS terminaltime,
        date_format(createtime,'%Y-%m-%d %H:%i:%s') AS createtime
        from INSBMarketActivity
        <where>
            <if test="activityname != null and activityname != ''">
                and activityname = #{activityname}
            </if>
            <if test="activitytype != null and activitytype != ''">
                and activitytype = #{activitytype}
            </if>
            <if test="effectivetime != null and effectivetime != ''">
                and date_format(effectivetime,'%Y-%m-%d') &gt;= date_format(#{effectivetime},'%Y-%m-%d')
            </if>
            <if test="terminaltime != null and terminaltime != ''">
                and date_format(terminaltime,'%Y-%m-%d') &lt;= date_format(#{terminaltime},'%Y-%m-%d')
            </if>
            <if test="status != null and status != ''">
                and status = #{status}
            </if>
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
             <if test="activitycode != null and activitycode != ''">
                and activitycode = #{activitycode}
            </if>
             <if test="tmpcode != null and tmpcode != ''">
                and tmpcode = #{tmpcode}
            </if>
        </where>
        ORDER BY
        <if test="sort != null and order != null">
            ${sort} ${order}
        </if>
        <if test="sort == null">
            createtime desc
        </if>
        <if test="offset != null and limit != null">
            LIMIT #{offset},#{limit}
        </if>
    </select>
    <select id="INSBMarketActivity_selectById" parameterType="String"
            resultType="com.zzb.extra.entity.INSBMarketActivity">
		select * from INSBMarketActivity where id = #{id}
	</select>
    <select id="INSBMarketActivity_deleteById" parameterType="String">
		delete from INSBMarketActivity where id = #{id}
	</select>
    <select id="INSBMarketActivity_updateById" parameterType="com.zzb.extra.entity.INSBMarketActivity">
		update INSBMarketActivity  set operator = #{operator},modifytime = #{modifytime},noti = #{noti},activityname = #{activityname},activitytype = #{activitytype},limited = #{limited},effectivetime = #{effectivetime},terminaltime = #{terminaltime},status = #{status},
		tmpcode = #{tmpcode},activitycode = #{activitycode} where id = #{id}
	</select>
    <select id="queryActivityListCount" parameterType="Map" resultType="Long">
       	select count(1) from INSBMarketActivity
        <where>
            <if test="activityname != null and activityname != ''">
                and activityname = #{activityname}
            </if>
            <if test="activitytype != null and activitytype != ''">
                and activitytype = #{activitytype}
            </if>
            <if test="effectivetime != null and effectivetime != ''">
                and date_format(effectivetime,'%Y-%m-%d') &gt;= date_format(#{effectivetime},'%Y-%m-%d')
            </if>
            <if test="terminaltime != null and terminaltime != ''">
                and date_format(terminaltime,'%Y-%m-%d') &lt;= date_format(#{terminaltime},'%Y-%m-%d')
            </if>
            <if test="status != null and status != ''">
                and status = #{status}
            </if>
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
            <if test="activitycode != null and activitycode != ''">
                and activitycode = #{activitycode}
            </if>
            <if test="tmpcode != null and tmpcode != ''">
                and tmpcode = #{tmpcode}
            </if>
        </where>
    </select>
    <select id="INSBMarketActivity_selectOne" parameterType="Map" resultType="com.zzb.extra.entity.INSBMarketActivity">
       	select * from INSBMarketActivity
        <where>
            <if test="activityname != null">
                and activityname = #{activityname}
            </if>
            <if test="activitytype != null">
                and activitytype = #{activitytype}
            </if>
            <if test="limited != null">
                and limited = #{limited}
            </if>
            <if test="effectivetime != null">
                and effectivetime = #{effectivetime}
            </if>
            <if test="terminaltime != null">
                and terminaltime = #{terminaltime}
            </if>
            <if test="status != null">
                and status = #{status}
            </if>
            <if test="activitycode != null and activitycode != ''">
                and activitycode = #{activitycode}
            </if>
            <if test="tmpcode != null and tmpcode != ''">
                and tmpcode = #{tmpcode}
            </if>
        </where>
        LIMIT 2
    </select>
    <select id="queryEffectiveActivity" parameterType="Map" resultType="Map">
       	select id,activityname,activitytype,limited,status,IFNULL(noti,'') AS noti,tmpcode,activitycode,
        date_format(effectivetime,'%Y-%m-%d') AS effectivetime,
        date_format(terminaltime,'%Y-%m-%d') AS terminaltime,
        date_format(createtime,'%Y-%m-%d %H:%i:%s') AS createtime
        from INSBMarketActivity
        <where>
            <if test="activitytype != null and activitytype != ''">
                and activitytype = #{activitytype}
            </if>
            <if test="activitycode != null and activitycode != ''">
                and activitycode = #{activitycode}
            </if>
            <if test="tmpcode != null and tmpcode != ''">
                and tmpcode = #{tmpcode}
            </if>
            <if test="effectivetime != null and effectivetime != ''">
                and date_format(effectivetime,'%Y-%m-%d') &lt;= date_format(#{effectivetime},'%Y-%m-%d')
            </if>
            <if test="terminaltime != null and terminaltime != ''">
                and date_format(terminaltime,'%Y-%m-%d') &gt; date_format(#{terminaltime},'%Y-%m-%d')
            </if>
            and status = '1'
        </where>
    </select>
    <select id="INSBMarketActivity_queryPrizeById" parameterType="String"
            resultType="Map">
       	select ap.id,ap.activityid,ap.prizeid,a.activityname,a.activitytype,p.prizename,p.status,a.activitycode,
           date_format(p.effectivetime,'%Y-%m-%d') AS effectivetime,
           date_format(p.terminaltime,'%Y-%m-%d') AS terminaltime
        from INSBMarketActivityPrize ap
        JOIN INSBMarketActivity a ON a.id=ap.activityid
        JOIN INSBMarketPrize p ON p.id=ap.prizeid where a.id = #{id}
    </select>
    <select id="INSBMarketActivity_queryPrizeCountById" parameterType="String"
            resultType="Long">
       	select count(1)
        from INSBMarketActivityPrize ap
        JOIN INSBMarketActivity a ON a.id=ap.activityid
        JOIN INSBMarketPrize p ON p.id=ap.prizeid where a.id = #{id}
    </select>
    <select id="INSBMarketActivity_queryCondById" parameterType="Map"
            resultType="Map">
       	select c.id,c.sourceid,c.conditionsource,c.paramdatatype,c.paramname,c.expression,
                c.paramvalue,c.createtime,c.operator,c.modifytime
        from INSBMarketActivity a
        JOIN INSBConditions c ON a.id=c.sourceid
        where a.id = #{id}
        and c.conditionsource = #{conditionsource}
    </select>
    <select id="INSBMarketActivity_queryCondCountById" parameterType="Map"
            resultType="Long">
       	select count(1)
        from INSBMarketActivity a
        JOIN INSBConditions c ON a.id = c.sourceid
        where a.id = #{id}
        and c.conditionsource = #{conditionsource}
    </select>
    <select id="INSBMarketActivity_selectMaxTmpcode" parameterType="Map" resultType="Long">
		select ifnull(max(tmpcode),0) as maxtmpcode from INSBMarketActivity
	</select>
	<select id="INSBMarketActivity_selectAll" resultType="com.zzb.extra.entity.INSBMarketActivity">
       	select * from INSBMarketActivity
     </select>
</mapper>