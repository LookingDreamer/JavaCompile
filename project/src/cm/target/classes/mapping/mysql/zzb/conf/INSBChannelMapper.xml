<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zzb.conf.entity">
	<!-- INSBChannel --> 
	<select id="INSBChannel_insert" parameterType="com.zzb.conf.entity.INSBChannel" resultType="int">
		insert into INSBChannel
		(id,operator,createtime,modifytime,noti,deptid,channelinnercode,trychannel,channelcode,channelsecret,upchannelcode,treechannel,channelname,shortname,channelkind,channeltype,channelgrade,type,rearchannelcode,province,city,county,address,zipcode,phone,fax,email,webaddress,satrapname,satrapcode,satrapphone,childflag,orderflag,treelevel,status,jobnum,illustration,senderphone,senderchannel,senderaddress,sendername,isdefined) 
		values
		(#{id},#{operator},#{createtime},#{modifytime},#{noti},#{deptid},#{channelinnercode},#{trychannel},#{channelcode},#{channelsecret},#{upchannelcode},#{treechannel},#{channelname},#{shortname},#{channelkind},#{channeltype},#{channelgrade},#{type},#{rearchannelcode},#{province},#{city},#{county},#{address},#{zipcode},#{phone},#{fax},#{email},#{webaddress},#{satrapname},#{satrapcode},#{satrapphone},#{childflag},#{orderflag},#{treelevel},#{status},#{jobnum},#{illustration},#{senderphone},#{senderchannel},#{senderaddress},#{sendername},#{isdefined}) 
	</select> 
	<select id="INSBChannel_selectByParentChannelCode" parameterType="String"
		resultType="com.zzb.conf.entity.INSBChannel">
		select * from INSBChannel WHERE upchannelcode = #{value} and deleteflag is null  ORDER BY  convert(channelname using gbk)  ASC
	</select>
	<select id="INSBChannel_selectChannelParent"  resultType="Map">
		select DISTINCT id,'' as pId,channelname name,if(childflag='1','true','false') isParent,'false' open,channelinnercode  innercode from insbchannel  where deleteflag is null and upchannelcode='' ORDER BY  convert(name using gbk)  ASC


	</select>
	<select id="INSBChannel_selectChildchannelByPid" parameterType="String" resultType="Map">
		 
	select id,upchannelcode pId,channelname name,'false' isParent,'false' open,channelinnercode  innercode from insbchannel  where deleteflag is null and upchannelcode=#{value}
	ORDER BY  convert(name using gbk)  ASC
	</select>
	
	<select id="INSBChannel_selectByChannelCode" parameterType="String" resultType="com.zzb.conf.entity.INSBChannel">
		select * from INSBChannel WHERE channelcode = #{value}
	</select>
	<select id="INSBChannel_selectChannelidByChannelinnercode" parameterType="String" resultType="String">
		select id from INSBChannel WHERE channelcode = #{value} and upchannelcode='' and deleteflag is null
	</select>
	
	<select id="INSBChannel_selectByChannel" parameterType="String" resultType="com.zzb.conf.entity.INSBChannel">
		select * from INSBChannel order by #{fieldName},orderflag  
	</select>
	
	<select id="INSBChannel_queryPid" parameterType="String" resultType="com.zzb.conf.entity.INSBChannel">
		select id from INSBChannel where noti = #{noti} 
	</select>
	
	<select id="INSBChannel_select" parameterType="Map" resultType="com.zzb.conf.entity.INSBChannel">
		select * from INSBChannel
		<where>
			<if test="deptid != null">
				and deptid = #{deptid}
			</if>
			<if test="channelinnercode != null">
				and channelinnercode = #{channelinnercode}
			</if>
			<if test="trychannel != null">
				and trychannel = #{trychannel}
			</if>
			<if test="channelcode != null">
				and channelcode = #{channelcode}
			</if>
			<if test="channelsecret != null">
				and channelsecret = #{channelsecret}
			</if>
			<if test="upchannelcode != null">
				and upchannelcode = #{upchannelcode}
			</if>
			<if test="treechannel != null">
				and treechannel = #{treechannel}
			</if>
			<if test="channelname != null">
				and channelname = #{channelname}
			</if>
			<if test="shortname != null">
				and shortname = #{shortname}
			</if>
			<if test="channelkind != null">
				and channelkind = #{channelkind}
			</if>
			<if test="channeltype != null">
				and channeltype = #{channeltype}
			</if>
			<if test="channelgrade != null">
				and channelgrade = #{channelgrade}
			</if>
			<if test="type != null">
				and type = #{type}
			</if>
			<if test="rearchannelcode != null">
				and rearchannelcode = #{rearchannelcode}
			</if>
			<if test="province != null">
				and province = #{province}
			</if>
			<if test="city != null">
				and city = #{city}
			</if>
			<if test="county != null">
				and county = #{county}
			</if>
			<if test="address != null">
				and address = #{address}
			</if>
			<if test="zipcode != null">
				and zipcode = #{zipcode}
			</if>
			<if test="phone != null">
				and phone = #{phone}
			</if>
			<if test="fax != null">
				and fax = #{fax}
			</if>
			<if test="email != null">
				and email = #{email}
			</if>
			<if test="webaddress != null">
				and webaddress = #{webaddress}
			</if>
			<if test="satrapname != null">
				and satrapname = #{satrapname}
			</if>
			<if test="satrapcode != null">
				and satrapcode = #{satrapcode}
			</if>
			<if test="satrapphone != null">
				and satrapphone = #{satrapphone}
			</if>
			<if test="childflag != null">
				and childflag = #{childflag}
			</if>
			<if test="orderflag != null">
				and orderflag = #{orderflag}
			</if>
			<if test="treelevel != null">
				and treelevel = #{treelevel}
			</if>
			<if test="status != null">
				and status = #{status}
			</if>
			<if test="jobnum != null">
				and jobnum = #{jobnum}
			</if>
		</where>
	</select>
	<select id="INSBChannel_selectOne" parameterType="Map" resultType="com.zzb.conf.entity.INSBChannel">
		select * from INSBChannel
		<where>
			<if test="deptid != null">
				and deptid = #{deptid}
			</if>
			<if test="channelinnercode != null">
				and channelinnercode = #{channelinnercode}
			</if>
			<if test="trychannel != null">
				and trychannel = #{trychannel}
			</if>
			<if test="channelcode != null">
				and channelcode = #{channelcode}
			</if>
			<if test="channelsecret != null">
				and channelsecret = #{channelsecret}
			</if>
			<if test="upchannelcode != null">
				and upchannelcode = #{upchannelcode}
			</if>
			<if test="treechannel != null">
				and treechannel = #{treechannel}
			</if>
			<if test="channelname != null">
				and channelname = #{channelname}
			</if>
			<if test="shortname != null">
				and shortname = #{shortname}
			</if>
			<if test="channelkind != null">
				and channelkind = #{channelkind}
			</if>
			<if test="channeltype != null">
				and channeltype = #{channeltype}
			</if>
			<if test="channelgrade != null">
				and channelgrade = #{channelgrade}
			</if>
			<if test="type != null">
				and type = #{type}
			</if>
			<if test="rearchannelcode != null">
				and rearchannelcode = #{rearchannelcode}
			</if>
			<if test="province != null">
				and province = #{province}
			</if>
			<if test="city != null">
				and city = #{city}
			</if>
			<if test="county != null">
				and county = #{county}
			</if>
			<if test="address != null">
				and address = #{address}
			</if>
			<if test="zipcode != null">
				and zipcode = #{zipcode}
			</if>
			<if test="phone != null">
				and phone = #{phone}
			</if>
			<if test="fax != null">
				and fax = #{fax}
			</if>
			<if test="email != null">
				and email = #{email}
			</if>
			<if test="webaddress != null">
				and webaddress = #{webaddress}
			</if>
			<if test="satrapname != null">
				and satrapname = #{satrapname}
			</if>
			<if test="satrapcode != null">
				and satrapcode = #{satrapcode}
			</if>
			<if test="satrapphone != null">
				and satrapphone = #{satrapphone}
			</if>
			<if test="childflag != null">
				and childflag = #{childflag}
			</if>
			<if test="orderflag != null">
				and orderflag = #{orderflag}
			</if>
			<if test="treelevel != null">
				and treelevel = #{treelevel}
			</if>
			<if test="status != null">
				and status = #{status}
			</if>
			<if test="jobnum != null">
				and jobnum = #{jobnum}
			</if>
			<if test="deleteflag != null">
				and deleteflag != #{deleteflag}
			</if>
		</where>
		LIMIT 2
	</select>

	<select id="INSBChannel_selectById" parameterType="String" resultType="com.zzb.conf.entity.INSBChannel">
		select * from INSBChannel where id = #{id}
	</select>
	<select id="INSBChannel_deleteById" parameterType="String">
		delete from INSBChannel where id = #{id}
	</select>
	<select id="INSBChannel_updateById" parameterType="com.zzb.conf.entity.INSBChannel">
		update INSBChannel  set operator = #{operator},modifytime = #{modifytime},noti = #{noti},deptid = #{deptid},channelinnercode = #{channelinnercode},trychannel = #{trychannel},
		channelcode = #{channelcode},upchannelcode = #{upchannelcode},treechannel = #{treechannel},
		channelname = #{channelname},shortname = #{shortname},channelkind = #{channelkind},channelsecret = #{channelsecret},
		channeltype = #{channeltype},channelgrade = #{channelgrade},
		type = #{type},rearchannelcode = #{rearchannelcode},province = #{province},
		city = #{city},county = #{county},address = #{address},zipcode = #{zipcode},
		phone = #{phone},fax = #{fax},email = #{email},webaddress = #{webaddress},satrapname = #{satrapname},
		satrapcode = #{satrapcode},satrapphone = #{satrapphone},orderflag = #{orderflag},treelevel = #{treelevel},
		status = #{status},jobnum = #{jobnum},illustration = #{illustration},senderphone = #{senderphone}, senderchannel = #{senderchannel}, 
		senderaddress = #{senderaddress}, sendername = #{sendername}, isdefined = #{isdefined} where id = #{id}
	</select>
	
	<update id="INSBChannel_updateChannelByid" parameterType="com.zzb.conf.entity.INSBChannel">
		update INSBChannel  set childflag = '1' where id = #{id}
	</update>
	
	<update id="INSBChannel_updateChannelDeleteflag" parameterType="String">
		update INSBChannel  set deleteflag = '0' where id = #{id}
	</update>
	
	<update id="INSBChannel_updateChannelByiddel" parameterType="com.zzb.conf.entity.INSBChannel">
		update INSBChannel  set childflag = '0' where id = #{id}
	</update>
	
	<select id="INSBChannel_selectCount" parameterType="Map" resultType="Long">
		select count(1) from INSBChannel
		<where>
			<if test="deptid != null">
				and deptid = #{deptid}
			</if>
			<if test="channelinnercode != null">
				and channelinnercode = #{channelinnercode}
			</if>
			<if test="trychannel != null">
				and trychannel = #{trychannel}
			</if>
			<if test="channelcode != null">
				and channelcode = #{channelcode}
			</if>
			<if test="channelsecret != null">
				and channelsecret = #{channelsecret}
			</if>
			<if test="upchannelcode != null">
				and upchannelcode = #{upchannelcode}
			</if>
			<if test="treechannel != null">
				and treechannel = #{treechannel}
			</if>
			<if test="channelname != null">
				and channelname = #{channelname}
			</if>
			<if test="shortname != null">
				and shortname = #{shortname}
			</if>
			<if test="channelkind != null">
				and channelkind = #{channelkind}
			</if>
			<if test="channeltype != null">
				and channeltype = #{channeltype}
			</if>
			<if test="channelgrade != null">
				and channelgrade = #{channelgrade}
			</if>
			<if test="type != null">
				and type = #{type}
			</if>
			<if test="rearchannelcode != null">
				and rearchannelcode = #{rearchannelcode}
			</if>
			<if test="province != null">
				and province = #{province}
			</if>
			<if test="city != null">
				and city = #{city}
			</if>
			<if test="county != null">
				and county = #{county}
			</if>
			<if test="address != null">
				and address = #{address}
			</if>
			<if test="zipcode != null">
				and zipcode = #{zipcode}
			</if>
			<if test="phone != null">
				and phone = #{phone}
			</if>
			<if test="fax != null">
				and fax = #{fax}
			</if>
			<if test="email != null">
				and email = #{email}
			</if>
			<if test="webaddress != null">
				and webaddress = #{webaddress}
			</if>
			<if test="satrapname != null">
				and satrapname = #{satrapname}
			</if>
			<if test="satrapcode != null">
				and satrapcode = #{satrapcode}
			</if>
			<if test="satrapphone != null">
				and satrapphone = #{satrapphone}
			</if>
			<if test="childflag != null">
				and childflag = #{childflag}
			</if>
			<if test="orderflag != null">
				and orderflag = #{orderflag}
			</if>
			<if test="treelevel != null">
				and treelevel = #{treelevel}
			</if>
			<if test="status != null">
				and status = #{status}
			</if>
			<if test="jobnum != null">
				and jobnum = #{jobnum}
			</if>
		</where>
	</select>
	<select id="INSBChannel_getBillTypeInfo" resultType="Map" parameterType="com.zzb.conf.entity.INSBChannel">
		select c.id,c.deptid,c.channelname,d.comname,ca.payperiod,ca.paytype,ca.payaccount,ca.interfacetype,ca.id AS agreementid from insbchannel c 
		LEFT JOIN inscdept d ON c.deptid= d.id
		LEFT JOIN insbchannelagreement ca ON c.id = ca.channelid AND c.deptid = ca.deptid 
		where c.id = #{id} 
	</select>
	<select id="INSBChannel_queryChannelProviderListData" resultType="com.zzb.extra.model.SelectProviderBeanForMinizzb" parameterType="Map">
	select DISTINCT e.id provid, LEFT(e.id,4) AS parentid, f.id AS agreementid,f.agreementname AS agreementname,e.prvname providername, aaa.jobnum agentcode,d.agreementid as chnagreementid
		FROM (select a.id FROM insbchannel a WHERE a.channelinnercode = #{channelinnercode} and a.childflag='1' and ( a.deleteflag != 0 OR a.deleteflag IS NULL) LIMIT 1) aa <!-- 父级渠道 如：minazzb -->
		LEFT JOIN insbchannel aaa ON aaa.upchannelcode=aa.id <!-- 所有子级渠道 -->
		LEFT JOIN insbchannelagreement b ON b.channelid=aaa.id
		LEFT JOIN insbagreementarea c ON c.agreementid=b.id
		LEFT JOIN insbagreementprovider d ON d.agreementid=b.id
		LEFT JOIN insbagreement f on f.id=d.agreeid
		LEFT JOIN insbprovider e ON e.id=d.providerid
	WHERE c.city = #{city} AND e.id IS NOT NULL AND f.id IS NOT NULL <!-- 同一渠道不同子渠道，不能配置相同地区。（即：相同渠道下，不同协议，不能配置同一地区）确保同一地区只配置一个渠道 -->
	</select>
	<select id="INSBChannel_queryChannelAgentCode" resultType="String" parameterType="Map">
		select aaa.jobnum
			FROM (select a.id FROM insbchannel a WHERE a.channelinnercode = #{channelinnercode} and a.childflag='1'  LIMIT 1) aa
			LEFT JOIN insbchannel aaa ON aaa.upchannelcode=aa.id
			LEFT JOIN insbchannelagreement b ON b.channelid=aaa.id
			LEFT JOIN insbagreementarea c ON c.agreementid=b.id
		WHERE c.city = #{city}
		LIMIT 1 <!-- 同一个渠道，相同地区重复配置。即同一地区不能出现在两个不同渠道协议 -->
	</select>

	<select id="INSBChannel_selectForCallBackURl" parameterType="com.zzb.conf.entity.INSBChannel" resultType="String">
		select  
			CASE
			WHEN address IS NOT NULL
			AND trim(address) != '' THEN
				address
			ELSE
				webaddress
			END AS cburl
		from INSBChannel
		<where>
			childflag='1' and (deleteflag  != '0' or deleteflag is NULL)
			<if test="channelinnercode != null">
				and channelinnercode = #{channelinnercode}
			</if>
		</where>

	</select>
	
	<select id="INSBChannel_countForMerchant" parameterType="Map" resultType="Long">
		SELECT
			count(1)
		FROM
			insbchannel t
		WHERE
			t.childflag = 1
		AND (
			t.deleteflag != 0
			OR t.deleteflag IS NULL
		)
	</select>
	
	<select id="INSBChannel_selectForMerchant" parameterType="Map" resultType="Map">
		SELECT
			t.channelinnercode,
			t.channelname,
			t.channelsecret,
			t.channeltype
		FROM
			insbchannel t
		WHERE
			t.childflag = 1
		AND (
			t.deleteflag != 0
			OR t.deleteflag IS NULL
		)
		AND t.upchannelcode = ''
		<if test="limit != null">
		LIMIT #{offset}, #{limit}
		</if>
	</select>
	
	<select id="INSBChannel_queryIllustration" parameterType="Map" resultType="Map">
		SELECT
			chn.illustration AS cill,
			pchn.illustration AS pcill
		FROM
			insbchannel chn,
			insbchannelagreement agreement,
			insbagreementarea area,
			insbchannel pchn
		WHERE
			chn.id = agreement.channelid
		AND agreement.id = area.agreementid
		AND chn.upchannelcode = pchn.channelcode
		AND area.city = #{city}
		AND chn.channelinnercode = #{channelinnercode}
		AND (
			chn.deleteflag != 0
			OR chn.deleteflag IS NULL
		)
		LIMIT 1 
	</select>
	<select id="INSBChannel_queryChildChannel" parameterType="Map" resultType="com.zzb.conf.entity.INSBChannel" >
		select * from insbchannel 
		
		where 
		channelinnercode = #{channelinnercode}
		and
		childflag ='0'
	</select>

	<select id="INSBChannel_querychanneltype" parameterType="String" resultType="Map" >
		SELECT c.`channelinnercode`,c.`channeltype` FROM INSBQuotetotalinfo q, insbchannel c
		WHERE c.childflag='1'
		AND c.`channelinnercode`=q.`purchaserchannel`
		AND q.`taskid`=#{taskid}
	</select>

	<select id="INSBChannel_getQuoteTotalInfo" parameterType="Map" resultType="Map" >
		SELECT
		  qt.`purchaserchannel` AS channelcode,
		  l.channelname AS channelname,
		  ws.maininstanceid AS taskid,
		  dept1.comcode AS deptcode,
		  dept1.comname AS deptname,
		  carh.carlicenseno AS carlicenseno,
		  inhp.name AS insuredname,
		  q.inscomcode,
		  pro.prvshotname AS inscomname,
		  DATE_FORMAT(ws.createtime,'%Y-%m-%d %H:%i:%S') AS createtime,
		  DATE_FORMAT(ws.modifytime,'%Y-%m-%d %H:%i:%S') AS modifytime,
		  CASE WHEN ws.taskcode = '33' THEN wfm.taskcode ELSE ws.taskcode END AS taskcode,
		  CASE WHEN ws.taskcode = '33' THEN zds2.codename ELSE zds.codename END AS tasktype,
		  CASE WHEN ws.taskcode = '33' THEN ws.maininstanceid  else ws.instanceId end AS subInstanceId
		FROM
		  insbworkflowsub ws
		  LEFT JOIN insbquoteinfo q
			ON ws.instanceid = q.workflowinstanceid
		  LEFT JOIN insbcarinfohis carh
			ON carh.taskid = ws.maininstanceid
			AND carh.inscomcode = q.inscomcode
		  LEFT JOIN insbinsuredhis insdh
			ON insdh.taskid = ws.maininstanceid
			AND q.inscomcode = insdh.inscomcode
		  LEFT JOIN insbperson inhp
			ON inhp.id = insdh.personid
		  LEFT JOIN insbworkflowmain wfm
			ON wfm.instanceid = ws.maininstanceid
		  LEFT JOIN insccode zds
			ON zds.codevalue = ws.taskcode
			AND zds.codetype = 'workflowNodelName'
			AND zds.parentcode = 'workflowNodelName'
		  LEFT JOIN insccode zds2
			ON zds2.codevalue = wfm.taskcode
			AND zds2.codetype = 'workflowNodelName'
			AND zds2.parentcode = 'workflowNodelName'
		  LEFT JOIN inscdept sdept
			ON sdept.comcode = q.deptcode
		  LEFT JOIN inscdept dept1 ON dept1.comcode = SUBSTRING(sdept.parentcodes,25,10)
		  INNER JOIN insbquotetotalinfo qt
			ON qt.taskid = ws.maininstanceid AND sourcefrom = #{sourcefrom}
		  LEFT JOIN insbprovider pro
			ON pro.prvcode = q.inscomcode
		  LEFT JOIN insbchannel l ON qt.`purchaserchannel` = l.channelinnercode AND l.childflag = '1'
			AND (l.deleteflag IS NULL OR l.deleteflag != '0')
		  <where>
			  <if test="channelId !=null and channelId != ''">
				  and qt.purchaserchannel = #{channelId}
			  </if>
			  <if test="taskStateList !=null and taskStateList != ''">
				  and CASE
				  WHEN ws.taskcode = '33'
				  THEN wfm.taskcode
				  ELSE ws.taskcode
				  END  IN
				  <foreach collection="taskStateList" index="index" item="item" open="(" separator="," close=")">
					  #{item}
				  </foreach>
			  </if>
			  <if test="prvId !=null and prvId != ''">
				  and q.inscomcode LIKE CONCAT(#{prvId},'%')
			  </if>
			  <if test="carLicenseNo !=null and carLicenseNo != ''">
				  and carh.carlicenseno = #{carLicenseNo}
			  </if>
			  <if test="insureName !=null and insureName != ''">
				  and inhp.name = #{insureName}
			  </if>
			  <if test="taskId !=null and taskId != ''">
				  and ws.maininstanceid = #{taskId}
			  </if>
			  <if test="comcode !=null and comcode != ''">
				  and dept1.comcode = #{comcode}
			  </if>
			  <if test="createtimestart !=null and createtimestart != ''">
				  and DATE_FORMAT(ws.createtime,'%Y-%m-%d') &gt;= #{createtimestart}
			  </if>
			  <if test="createtimeend !=null and createtimeend != ''">
				  and DATE_FORMAT(ws.createtime,'%Y-%m-%d') &lt;= #{createtimeend}
			  </if>
		  </where>
			ORDER BY createtime desc
			LIMIT #{offset},#{limit}
	</select>

	<select id="INSBChannel_getQuoteTotalInfoCount" parameterType="Map" resultType="Long" >
		SELECT
		 COUNT(1)
		FROM
		insbworkflowsub ws
		LEFT JOIN insbquoteinfo q
		ON ws.instanceid = q.workflowinstanceid
		LEFT JOIN insbcarinfohis carh
		ON carh.taskid = ws.maininstanceid
		AND carh.inscomcode = q.inscomcode
		LEFT JOIN insbinsuredhis insdh
		ON insdh.taskid = ws.maininstanceid
		AND q.inscomcode = insdh.inscomcode
		LEFT JOIN insbperson inhp
		ON inhp.id = insdh.personid
		LEFT JOIN insbworkflowmain wfm
		ON wfm.instanceid = ws.maininstanceid
		LEFT JOIN insccode zds
		ON zds.codevalue = ws.taskcode
		AND zds.codetype = 'workflowNodelName'
		AND zds.parentcode = 'workflowNodelName'
		LEFT JOIN insccode zds2
		ON zds2.codevalue = wfm.taskcode
		AND zds2.codetype = 'workflowNodelName'
		AND zds2.parentcode = 'workflowNodelName'
		LEFT JOIN inscdept sdept
		ON sdept.comcode = q.deptcode
		LEFT JOIN inscdept dept1 ON dept1.comcode = SUBSTRING(sdept.parentcodes,25,10)
		INNER JOIN insbquotetotalinfo qt
		ON qt.taskid = ws.maininstanceid AND sourcefrom = #{sourcefrom}
		LEFT JOIN insbprovider pro
		ON pro.prvcode = q.inscomcode
		LEFT JOIN insbchannel l ON qt.`purchaserchannel` = l.channelinnercode AND l.childflag = '1'
		AND (l.deleteflag IS NULL OR l.deleteflag != '0')
		<where>
			<if test="channelId !=null and channelId != ''">
				and qt.purchaserchannel = #{channelId}
			</if>
			<if test="taskStateList !=null and taskStateList != ''">
				and CASE
				WHEN ws.taskcode = '33'
				THEN wfm.taskcode
				ELSE ws.taskcode
				END IN
				<foreach collection="taskStateList" index="index" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
			<if test="prvId !=null and prvId != ''">
				and q.inscomcode LIKE CONCAT(#{prvId},'%')
			</if>
			<if test="carLicenseNo !=null and carLicenseNo != ''">
				and carh.carlicenseno = #{carLicenseNo}
			</if>
			<if test="insureName !=null and insureName != ''">
				and inhp.name = #{insureName}
			</if>
			<if test="taskId !=null and taskId != ''">
				and ws.maininstanceid = #{taskId}
			</if>
			<if test="comcode !=null and comcode != ''">
				and dept1.comcode = #{comcode}
			</if>
			<if test="createtimestart !=null and createtimestart != ''">
				and DATE_FORMAT(ws.createtime,'%Y-%m-%d') &gt;= #{createtimestart}
			</if>
			<if test="createtimeend !=null and createtimeend != ''">
				and DATE_FORMAT(ws.createtime,'%Y-%m-%d') &lt;= #{createtimeend}
			</if>
		</where>
	</select>

	<select id="INSBChannel_queryCommissionList" parameterType="Map" resultType="com.zzb.extra.entity.INSBCommission">
		select * from INSBCommission
		<where>
			<if test="taskid != null">
				and taskid = #{taskid}
			</if>
			<if test="commissionrateid != null">
				and commissionrateid = #{commissionrateid}
			</if>
			<if test="counts != null">
				and counts = #{counts}
			</if>
			<if test="status != null">
				and status = #{status}
			</if>
			<if test="providercode != null and providercode !='' ">
				and providercode = #{providercode}
			</if>
			<if test="commissionFlag != null and commissionFlag != '' ">
				and commissionflag = #{commissionFlag}
			</if>
		</where>
		GROUP BY createtime
	</select>

	<select id="INSBChannel_selectPayChannelListByChannelIdAndPrvId" parameterType="Map" resultType="com.zzb.conf.entity.INSBPaychannel">
		select d.*
		from insbagreementpaymethod a,insbchannelagreement b ,insbchannel c,insbpaychannel d
		where a.agreementid = b.id
		and b.channelid = c.id
		and a.paychannelid = d.id
		and c.channelinnercode = #{channelId}
		and a.providerid = #{providerid}
		and (
			c.deleteflag != 0
			or c.deleteflag IS NULL
		)
	</select>
	<select id="INSBChannel_selectSenderInfoByCityAndChannelcode" parameterType="Map" resultType="Map">
		SELECT
		chn.senderaddress,
		chn.senderchannel,
		chn.sendername,
		chn.senderphone,
		chn.isdefined,
		pchn.senderaddress paddress,
		pchn.senderchannel pchannel,
		pchn.sendername pname,
		pchn.senderphone pphone,
		pchn.isdefined pisdefined
		FROM
			insbchannel chn,
			insbchannelagreement agreement,
			insbagreementarea area,
			insbchannel pchn
		WHERE
			chn.id = agreement.channelid
		AND agreement.id = area.agreementid
		
		AND chn.upchannelcode = pchn.channelcode
		AND area.city = #{city}
		AND chn.channelinnercode = #{channelinnercode}
		AND (
			chn.deleteflag != 0
			OR chn.deleteflag IS NULL
		)
	
	</select>
</mapper>
