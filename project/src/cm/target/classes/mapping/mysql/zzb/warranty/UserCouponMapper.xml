<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zzb.warranty.model">

    <select id="UserCoupon_getUserCoupon" parameterType="map" resultType="com.zzb.warranty.model.UserCoupon">
        SELECT * FROM usercoupon WHERE couponCode=#{couponCode} AND userCode=#{userCode}
    </select>

    <select id="UserCoupon_getUserCouponByCouponCode" parameterType="map"
            resultType="com.zzb.warranty.model.UserCoupon">
        SELECT * FROM usercoupon
        <where>
            couponCode=#{couponCode}
        </where>
    </select>

    <select id="UserCoupon_getUserCouponsByProduct" parameterType="map" resultType="com.zzb.warranty.model.UserCoupon">
        SELECT * FROM usercoupon WHERE usercode=#{userCode} and productCode=#{productCode} ORDER BY createTime DESC
    </select>

    <insert id="UserCoupon_insertUserCoupon" parameterType="com.zzb.warranty.model.UserCoupon">
		INSERT INTO usercoupon
		(couponCode, amount, description, userCode, userName, couponId, createTime, effectiveTime, expireTime, productCode)
		VALUES
		(#{couponCode}, #{amount}, #{description}, #{userCode}, #{userName}, #{couponId}, #{createTime},
		#{effectiveTime}, #{expireTime}, #{productCode})
	</insert>

    <select id="UserCoupon_getUserCoupons" parameterType="string" resultType="com.zzb.warranty.model.UserCoupon">
        SELECT * FROM usercoupon WHERE userCode=#{userCode} ORDER BY createTime DESC
    </select>

    <delete id="UserCoupon_removeUserCoupon" parameterType="string">
        DELETE FROM usercoupon WHERE couponCode=#{couponCode}
    </delete>

    <update id="UserCoupon_useUserCoupon" parameterType="string">
        UPDATE usercoupon SET orderNo=#{orderNo}, isUsed=TRUE, usedTime=#{usedTime} WHERE couponCode=#{couponCode}
    </update>

</mapper>