<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zzb.extra.entity">
    <!-- INSBMarketActivityPrize -->
    <select id="INSBMarketActivityPrize_insert" parameterType="com.zzb.extra.entity.INSBMarketActivityPrize"
            resultType="int">
		insert into INSBMarketActivityPrize
		(id,operator,createtime,modifytime,noti,activityid,prizeid) 
		values
		(#{id},#{operator},#{createtime},#{modifytime},#{noti},#{activityid},#{prizeid}) 
	</select>
    <select id="queryActivityPrizeList" parameterType="Map" resultType="Map">
       	select ap.id,a.activityname,IFNULL(a.noti,'') AS noti,p.prizename,pt.codename as prizetype,p.counts,p.autouse,
        IF(p.effectivedays &gt; 0,DATE_FORMAT(date_add(NOW(), INTERVAL 1 day),'%Y-%m-%d'),IFNULL(DATE_FORMAT(p.effectivetime,'%Y-%m-%d'),'')) AS effectivetime,
        IF(p.effectivedays &gt; 0,DATE_FORMAT(date_add(NOW(), INTERVAL p.effectivedays+1 day),'%Y-%m-%d'),IFNULL(DATE_FORMAT(p.terminaltime,'%Y-%m-%d'),'')) AS terminaltime,p.effectivedays
        from INSBMarketActivityPrize ap
        LEFT JOIN INSBMarketActivity a ON a.id=ap.activityid
        LEFT JOIN INSBMarketPrize p ON p.id=ap.prizeid
        LEFT JOIN INSCcode pt ON pt.parentcode='market' and pt.codetype='prizeType' and pt.codevalue=p.prizetype
        <where>
            <if test="activityidlist != null and activityidlist != ''">
                and ap.activityid in
                <foreach item="item" index="index" collection="activityidlist" open="(" separator="," close=")">
                   #{item}
                </foreach>
            </if>
            <if test="activityid != null and activityid != ''">
                and ap.activityid = #{activityid}
            </if>
            <if test="prizeid != null and prizeid != ''">
                and ap.prizeid = #{prizeid}
            </if>
            <if test="activitytype != null and activitytype != ''">
                and a.activitytype = #{activitytype}
            </if>
            <if test="activityprizeid != null and activityprizeid != ''">
                and ap.id = #{activityprizeid}
            </if>
            and DATE_FORMAT(p.terminaltime,'%Y-%m-%d') &gt;= DATE_FORMAT(NOW(),'%Y-%m-%d')
        </where>
    </select>
    <select id="INSBMarketActivityPrize_selectById" parameterType="String"
            resultType="com.zzb.extra.entity.INSBMarketActivityPrize">
		select * from INSBMarketActivityPrize where id = #{id}
	</select>
    <select id="INSBMarketActivityPrize_deleteById" parameterType="String">
		delete from INSBMarketActivityPrize where id = #{id}
	</select>
    <select id="INSBMarketActivityPrize_updateById" parameterType="com.zzb.extra.entity.INSBMarketActivityPrize">
		update INSBMarketActivityPrize  set operator = #{operator},modifytime = #{modifytime},noti = #{noti},activityid = #{activityid},prizeid = #{prizeid} where id = #{id}
	</select>
    <select id="queryActivityPrizeListCount" parameterType="Map" resultType="Long">
       	select count(1) from INSBMarketActivityPrize ap
        LEFT JOIN INSBMarketActivity a ON a.id=ap.activityid
        LEFT JOIN INSBMarketPrize p ON p.id=ap.prizeid
        <where>
            <if test="activityidlist != null and activityidlist != ''">
                and ap.activityid in
                <foreach item="item" index="index" collection="activityidlist" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="activityid != null and activityid != ''">
                and ap.activityid = #{activityid}
            </if>
            <if test="prizeid != null and prizeid != ''">
                and ap.prizeid = #{prizeid}
            </if>
            <if test="activitytype != null and activitytype != ''">
                and a.activitytype = #{activitytype}
            </if>
            <if test="activityprizeid != null and activityprizeid != ''">
                and ap.id = #{activityprizeid}
            </if>
            and DATE_FORMAT(p.terminaltime,'%Y-%m-%d') &gt;= DATE_FORMAT(NOW(),'%Y-%m-%d')
        </where>
    </select>

    <select id="INSBMarketActivityPrize_selectOne" parameterType="Map"
            resultType="com.zzb.extra.entity.INSBMarketActivityPrize">
       	select * from INSBMarketActivityPrize
        <where>
            <if test="activityid != null">
                and activityid = #{activityid}
            </if>
            <if test="prizeid != null">
                and prizeid = #{prizeid}
            </if>
        </where>
        LIMIT 2
    </select>
    <!--refresh-->
</mapper>