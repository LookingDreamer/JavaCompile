<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zzb.conf.entity">
	<!-- INSBBusinessmanagegroup -->
	<select id="INSBBusinessmanagegroup_insert" parameterType="com.zzb.conf.entity.INSBBusinessmanagegroup"
		resultType="int">
		insert into INSBBusinessmanagegroup
		(id,operator,createtime,modifytime,noti,pid,groupname,groupkind,groupnum,organizationid,roleid,privilegestate,groupcode,tasktype,workload)
		values
		(#{id},#{operator},#{createtime},#{modifytime},#{noti},#{pid},#{groupname},#{groupkind},#{groupnum},#{organizationid},#{roleid},#{privilegestate},#{groupcode},#{tasktype},#{workload})
	</select>

	<select id="INSBBusinessmanagegroup_insertReturnId"
		parameterType="com.zzb.conf.entity.INSBBusinessmanagegroup"
		resultType="int">
		insert into INSBBusinessmanagegroup
		(id,operator,createtime,modifytime,noti,pid,groupname,groupkind,groupnum,organizationid,roleid,privilegestate,groupcode,tasktype)
		values
		(#{id},#{operator},#{createtime},#{modifytime},#{noti},#{pid},#{groupname},#{groupkind},#{groupnum},#{organizationid},#{roleid},#{privilegestate},#{groupcode},#{tasktype})
	</select>

	<select id="INSBBusinessmanagegroup_select" parameterType="Map"
		resultType="com.zzb.conf.entity.INSBBusinessmanagegroup">
		select a.*,b.codename as groupkindstr from INSBBusinessmanagegroup a
		left join insccode b on a.groupkind= b.codevalue
		<where>
			<if test="pid != null">
				and a.pid = #{pid}
			</if>
			<if test="groupname != null">
				and a.groupname = #{groupname}
			</if>
			<if test="groupkind != null">
				and a.groupkind = #{groupkind}
			</if>
			<if test="groupnum != null">
				and a.groupnum = #{groupnum}
			</if>
			<if test="organizationid != null">
				and a.organizationid = #{organizationid}
			</if>
			<if test="roleid != null">
				and a.roleid = #{roleid}
			</if>
			<if test="privilegestate != null">
				and a.privilegestate = #{privilegestate}
			</if>
		</where>
	</select>
	
	<select id="INSBBusinessmanagegroup_selectOne" parameterType="Map"
		resultType="com.zzb.conf.entity.INSBBusinessmanagegroup">
		select a.*,b.codename as groupkindstr from INSBBusinessmanagegroup a
		left join insccode b on a.groupkind= b.codevalue
		<where>
			<if test="pid != null">
				and a.pid = #{pid}
			</if>
			<if test="groupname != null">
				and a.groupname = #{groupname}
			</if>
			<if test="groupkind != null">
				and a.groupkind = #{groupkind}
			</if>
			<if test="groupnum != null">
				and a.groupnum = #{groupnum}
			</if>
			<if test="organizationid != null">
				and a.organizationid = #{organizationid}
			</if>
			<if test="roleid != null">
				and a.roleid = #{roleid}
			</if>
			<if test="privilegestate != null">
				and a.privilegestate = #{privilegestate}
			</if>
		</where>
		limit 2
	</select>
	
	<select id="INSBBusinessmanagegroup_selectByPage" parameterType="Map"
		resultType="com.zzb.conf.entity.INSBBusinessmanagegroup">
		select a.*,b.codename as groupkindstr from INSBBusinessmanagegroup a
		, insccode b , inscdept dept 
		<where>
			a.groupkind= b.codevalue and  dept.id=a.organizationid 
			<if test="userDept !=null">
				and  dept.deptinnercode like CONCAT(#{userDept},'%')
			</if>
			<if test="pid != null">
				and a.pid = #{pid}
			</if>
			<if test="groupname != null">
				and a.groupname like CONCAT('%',#{groupname},'%')
			</if>
			<if test="groupkind != null and groupkind!=0">
				and a.groupkind = #{groupkind}
			</if>
			<if test="groupnum != null ">
				and a.groupnum = #{groupnum}
			</if>
			<if test="organizationid != null">
				and a.organizationid = #{organizationid}
			</if>
			<if test="roleid != null">
				and a.roleid = #{roleid}
			</if>
			<if test="privilegestate != null and privilegestate!=0 ">
				and a.privilegestate = #{privilegestate}
			</if>
		</where>
		<!-- order by a.createtime desc -->
		order by 
		<if test="sort != null and order != null">
			  ${sort}  ${order}  
		</if>
		<if test="sort == null">
			 a.createtime desc 
		</if>
		limit #{offset},#{limit}
	</select>
	<select id="INSBBusinessmanagegroup_selectCountByParam"
		parameterType="Map" resultType="int">
		select count(1) from INSBBusinessmanagegroup a
		, insccode b , inscdept dept 
		<where>
			a.groupkind= b.codevalue and  dept.id=a.organizationid 
			<if test="userDept !=null">
				and  dept.deptinnercode like CONCAT(#{userDept},'%')
			</if>
			<if test="pid != null">
				and a.pid = #{pid}
			</if>
			<if test="groupname != null">
				and a.groupname like CONCAT('%',#{groupname},'%')
			</if>
			<if test="groupkind != null and groupkind!=0">
				and a.groupkind = #{groupkind}
			</if>
			<if test="groupnum != null ">
				and a.groupnum = #{groupnum}
			</if>
			<if test="organizationid != null">
				and a.organizationid = #{organizationid}
			</if>
			<if test="roleid != null">
				and a.roleid = #{roleid}
			</if>
			<if test="privilegestate != null and privilegestate!=0 ">
				and a.privilegestate = #{privilegestate}
			</if>
		</where>
	</select>
	<select id="INSBBusinessmanagegroup_selectById" parameterType="String"
		resultType="com.zzb.conf.entity.INSBBusinessmanagegroup">
		select a.*,b.codename as groupkindstr from
		INSBBusinessmanagegroup a
		left join insccode b on a.groupkind=b.codevalue and b.codetype='grouptype'
		where a.id = #{id}
	</select>

	<select id="INSBBusinessmanagegroup_selectBycode" parameterType="String"
		resultType="String">
		select id from INSBBusinessmanagegroup where groupcode =
		#{code}
	</select>
	<select id="INSBBusinessmanagegroup_selectIdsByIdsAndTaskType4CertifiTask" parameterType="Map" resultType="String">
		select id from INSBBusinessmanagegroup where privilegestate = '1' 
		 <if test="deptId !=null">
		 		and organizationid =( SELECT SUBSTR(parentcodes FROM 25 FOR 10) as organizationid  from inscdept where comcode=#{deptId})
		 </if>	
		 <if test="deptId !=null">
		 		and id in (select distinct(groupid) from INSBGroupdept where deptid = #{deptId})
		 </if>
		 <if test="providerid !=null">
		 		and id in (select distinct(groupid) from INSBGroupprovide where  provideid = #{providerid}) 
		 </if>		
		 <if test="tasktype !=null">
				and tasktype like CONCAT('%',#{tasktype},'%')
		 </if>
	</select>	 
	<select id="INSBBusinessmanagegroup_selectIdsByIdsAndTaskType4Task" parameterType="Map"
		resultType="String">
		select id from INSBBusinessmanagegroup
		<where>
			privilegestate = '1'
			<if test="deptId !=null ">
				and organizationid =(	select SUBSTR(parentcodes FROM 25 FOR 10) as organizationid  from inscdept where comcode=#{deptId} )
			</if>
			<if test="ids !=null">
				and id in 
				<foreach collection="ids" item="item" index="index" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
			<if test="tasktype !=null">
				and tasktype like CONCAT('%',#{tasktype},'%')
			</if>
		</where>
	</select>
	<select id="INSBBusinessmanagegroup_selectByGroupName"
		parameterType="String" resultType="com.zzb.conf.entity.INSBBusinessmanagegroup">
		select id,groupname from
		INSBBusinessmanagegroup where groupname like
		CONCAT('%',#{groupname},'%')
	</select>
	
	
	<select id="INSBBusinessmanagegroup_selectWorkloadByUsers4Task"	parameterType="List" resultType="Map">
		select b.usercode,a.workload from
		INSBBusinessmanagegroup a , insbgroupmembers b 
		<where>
			a.id=b.groupid
			<if test="list !=null">
				and b.usercode in
				<foreach collection="list" item="item" index="index" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
		</where>
		order by a.workload desc
	</select>
	<select id="INSBBusinessmanagegroup_deleteById" parameterType="String">
		delete from INSBBusinessmanagegroup where id = #{id}
	</select>
	<select id="INSBBusinessmanagegroup_updateById" parameterType="com.zzb.conf.entity.INSBBusinessmanagegroup">
		update INSBBusinessmanagegroup set operator = #{operator},modifytime =
		#{modifytime},noti = #{noti},pid = #{pid},groupname =
		#{groupname},groupkind = #{groupkind},groupnum =
		#{groupnum},organizationid = #{organizationid},roleid =
		#{roleid},privilegestate = #{privilegestate},tasktype=#{tasktype},groupcode=#{groupcode},workload=#{workload} where id = #{id}
	</select>

	<select id="INSBBusinessmanagegroup_updateGroupCountByGroupId"
		parameterType="com.zzb.conf.entity.INSBBusinessmanagegroup">
		update INSBBusinessmanagegroup set groupnum =
		#{groupnum},modifytime = #{modifytime} where id = #{id}
	</select>
	<select id="INSBBusinessmanagegroup_selectCount" parameterType="Map"
		resultType="Long">
		select count(1) from INSBBusinessmanagegroup
		<where>
			<if test="pid != null">
				and pid = #{pid}
			</if>
			<if test="groupname != null">
				and groupname = #{groupname}
			</if>
			<if test="groupkind != null">
				and groupkind = #{groupkind}
			</if>
			<if test="groupnum != null">
				and groupnum = #{groupnum}
			</if>
			<if test="organizationid != null">
				and organizationid = #{organizationid}
			</if>
			<if test="roleid != null">
				and roleid = #{roleid}
			</if>
			<if test="privilegestate != null">
				and privilegestate = #{privilegestate}
			</if>
		</where>
	</select>

	<select id="INSBBusinessmanagegroup_selectByTasksetid"
		parameterType="String" resultType="com.zzb.conf.entity.INSBBusinessmanagegroup">
		select a.id,a.privilegestate
		from INSBBusinessmanagegroup a
		inner join INSBGrouptaskset b on a.id=b.groupid
		where a.groupnum > 0 and
		b.tasksetid = #{tasksetid}
	</select>
</mapper>