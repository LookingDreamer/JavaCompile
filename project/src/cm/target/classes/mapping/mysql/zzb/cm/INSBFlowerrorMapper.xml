<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zzb.cm.entity">
	<!-- INSBFlowerror -->
	<select id="INSBFlowerror_insert" parameterType="com.zzb.cm.entity.INSBFlowerror" resultType="int">
		insert into INSBFlowerror
		(id,operator,createtime,modifytime,noti,taskid,inscomcode,currenthandle,flowcode,flowname,firoredi,taskstatus,errorcode,errordesc,result) 
		values
		(#{id},#{operator},#{createtime},#{modifytime},#{noti},#{taskid},#{inscomcode},#{currenthandle},#{flowcode},#{flowname},#{firoredi},#{taskstatus},#{errorcode},#{errordesc},#{result}) 
	</select>
	<select id="INSBFlowerror_select" parameterType="Map" resultType="com.zzb.cm.entity.INSBFlowerror">
		select * from INSBFlowerror
		<where>
			<if test="taskid != null">
				and taskid = #{taskid}
			</if>
			<if test="inscomcode != null">
				and inscomcode = #{inscomcode}
			</if>
			<if test="currenthandle != null">
				and currenthandle = #{currenthandle}
			</if>
			<if test="flowcode != null">
				and flowcode = #{flowcode}
			</if>
			<if test="flowname != null">
				and flowname = #{flowname}
			</if>
			<if test="firoredi != null">
				and firoredi = #{firoredi}
			</if>
			<if test="taskstatus != null">
				and taskstatus = #{taskstatus}
			</if>
			<if test="errorcode != null">
				and errorcode = #{errorcode}
			</if>
			<if test="errordesc != null">
				and errordesc = #{errordesc}
			</if>
			<if test="result != null">
				and result = #{result}
			</if>
		</where>
		 order by createtime desc
	</select>
	<select id="INSBFlowerror_selectErrorListPaging" parameterType="Map"
		resultType="Map">
		select  
		a.taskid,
		a.inscomcode,
		a.taskstatus,
		a.firoredi,
		a.flowcode,
		a.errorcode,
		a.errordesc,
		DATE_FORMAT(a.createtime,'%Y-%m-%d %H:%i:%s') createtime,
		DATE_FORMAT(a.modifytime,'%Y-%m-%d %H:%i:%s') modifytime,
		a.operator,
		dept.comname
		from (SELECT *from INSBFlowerror a
				where  a.createtime &gt;= #{taskcreatetimeup}
				AND a.createtime &lt;= #{taskcreatetimedown}
			<if test="taskid != null">
				and a.taskid = #{taskid}
			</if>
			<if test="inscomcode != null">
				and a.inscomcode = #{inscomcode}
			</if>
			<if test="currenthandle != null">
				and a.currenthandle = #{currenthandle}
			</if>
			<if test="flowcode != null">
				and a.flowcode = #{flowcode}
			</if>
			<if test="flowname != null">
				and a.flowname = #{flowname}
			</if>
			<if test="firoredi != null">
				and a.firoredi = #{firoredi}
			</if>
			<if test="taskstatus != null">
				and a.taskstatus = #{taskstatus}
			</if>
			<if test="errorcode != null">
				and a.errorcode = #{errorcode}
			</if>
			<if test="errordesc != null">
				and a.errordesc = #{errordesc}
			</if>
			<if test="result != null">
				and a.result = #{result}
			</if>
		) a
		LEFT JOIN insbquotetotalinfo qt on qt.taskid=a.taskid
		LEFT JOIN insbquoteinfo q on q.quotetotalinfoid =qt.id and q.inscomcode=a.inscomcode
		LEFT JOIN inscdept dept ON dept.comcode=q.deptcode
		where  dept.deptinnercode LIKE CONCAT(#{deptcode},'%')
		 order by a.createtime desc 
		 limit #{offset},#{limit}
	</select>
	<select id="INSBFlowerror_selectErrorCountPaging" parameterType="Map"
		resultType="long">
		select count(1) from (SELECT *from INSBFlowerror a
								where  a.createtime &gt;= #{taskcreatetimeup}
								AND a.createtime &lt;= #{taskcreatetimedown}
								<if test="taskid != null and taskid !=''">
									and a.taskid = #{taskid}
								</if>
								<if test="inscomcode != null and inscomcode !=''">
									and a.inscomcode = #{inscomcode}
								</if>
								<if test="firoredi != null and firoredi !=''">
									and a.firoredi = #{firoredi}
								</if>
								<if test="flowcode != null and flowcode !=''">
									and a.flowcode = #{flowcode}
								</if>
		) a
		LEFT JOIN insbquotetotalinfo qt on qt.taskid=a.taskid
		LEFT JOIN insbquoteinfo q on q.quotetotalinfoid =qt.id and q.inscomcode=a.inscomcode
		LEFT JOIN inscdept dept ON dept.comcode=q.deptcode
		where dept.deptinnercode LIKE CONCAT(#{deptcode},'%')
	</select>
	<!-- 获取所有的任务状态 -->
	<select id="INSBFlowerror_selectflowcode" resultType="com.zzb.cm.entity.INSBFlowerror">
		/*select  DISTINCT(flowcode),flowname from INSBFlowerror*/
		 select codevalue as flowcode,codename as flowname
		 from insccode where codetype='flowcode' and parentcode='flowcode' order by codeorder;
	</select>
	<select id="INSBFlowerror_selectById" parameterType="String" resultType="com.zzb.cm.entity.INSBFlowerror">
		select * from INSBFlowerror where id = #{id}
	</select>
	<select id="INSBFlowerror_deleteById" parameterType="String">
		delete from INSBFlowerror where id = #{id}
	</select>
	<select id="INSBFlowerror_updateById" parameterType="com.zzb.cm.entity.INSBFlowerror">
		update INSBFlowerror  set operator = #{operator},modifytime = #{modifytime},noti = #{noti},taskid = #{taskid},inscomcode = #{inscomcode},currenthandle = #{currenthandle},flowcode = #{flowcode},flowname = #{flowname},firoredi = #{firoredi},taskstatus = #{taskstatus},errorcode = #{errorcode},errordesc = #{errordesc},result = #{result} where id = #{id}
	</select>
	<select id="INSBFlowerror_selectCount" parameterType="Map" resultType="Long">
		select count(1) from INSBFlowerror
		<where>
			<if test="taskid != null">
				and taskid = #{taskid}
			</if>
			<if test="inscomcode != null">
				and inscomcode = #{inscomcode}
			</if>
			<if test="currenthandle != null">
				and currenthandle = #{currenthandle}
			</if>
			<if test="flowcode != null">
				and flowcode = #{flowcode}
			</if>
			<if test="flowname != null">
				and flowname = #{flowname}
			</if>
			<if test="firoredi != null">
				and firoredi = #{firoredi}
			</if>
			<if test="taskstatus != null">
				and taskstatus = #{taskstatus}
			</if>
			<if test="errorcode != null">
				and errorcode = #{errorcode}
			</if>
			<if test="errordesc != null">
				and errordesc = #{errordesc}
			</if>
			<if test="result != null">
				and result = #{result}
			</if>
		</where>
	</select>
	<select id="INSBFlowerror_selectOne" parameterType="Map" resultType="com.zzb.cm.entity.INSBFlowerror">
		select * from INSBFlowerror
		<where>
			<if test="taskid != null">
				and taskid = #{taskid}
			</if>
			<if test="inscomcode != null">
				and inscomcode = #{inscomcode}
			</if>
			<if test="currenthandle != null">
				and currenthandle = #{currenthandle}
			</if>
			<if test="flowcode != null">
				and flowcode = #{flowcode}
			</if>
			<if test="flowname != null">
				and flowname = #{flowname}
			</if>
			<if test="firoredi != null">
				and firoredi = #{firoredi}
			</if>
			<if test="taskstatus != null">
				and taskstatus = #{taskstatus}
			</if>
			<if test="errorcode != null">
				and errorcode = #{errorcode}
			</if>
			<if test="errordesc != null">
				and errordesc = #{errordesc}
			</if>
			<if test="result != null">
				and result = #{result}
			</if>
		</where>
		LIMIT 1
	</select>
	<!-- 
	    0  提示性规则
		1  转人工报价
		2  限制性规则
		3  阻断性规则
		4  转人工规则
		5  年款匹配没有匹配到  
		6  非费改地区 （保留）
		7  特种车转人工 （保留）  
		8  代理人备注    
		9  投保日期（保留）   
		10 重复投保关闭子流程提示 
		11 普通平台查询80秒为查到数据
		12 规则平台查询80秒未返回
		1，5，8 转人工   4,9,11 转规则
	-->
	<select id="INSBFlowerror_selectMydataOne" parameterType="Map" resultType="int">
		select count(*) from INSBFlowerror where taskid = #{taskid} and inscomcode = #{inscomcode} 
		and firoredi = #{firoredi} and flowcode in('1','5','8') LIMIT 1
	</select>
	
	<!-- 
	    0  提示性规则
		1  转人工报价
		2  限制性规则
		3  阻断性规则
		4  转人工规则
		5  年款匹配没有匹配到  
		6  非费改地区 （保留）
		7  特种车转人工 （保留）  
		8  代理人备注    
		9  投保日期（保留）   
		10 重复投保关闭子流程提示 
		11 普通平台查询80秒为查到数据
		12 规则平台查询60秒未返回数据
		1，5，8 转人工   4  转规则
	-->
	<select id="INSBFlowerror_selectMydataOne_GZ" parameterType="Map" resultType="int">
		select count(*) from INSBFlowerror where taskid = #{taskid} and inscomcode = #{inscomcode} 
		and firoredi = #{firoredi} and flowcode in('4') LIMIT 1
	</select>
	
	<!--1，5，8 转人工  -->
	<select id="INSBFlowerror_selectMydataOne_RG" parameterType="Map" resultType="int">
		select count(*) from INSBFlowerror where taskid = #{taskid} and inscomcode = #{inscomcode} 
		and firoredi = #{firoredi} and flowcode in('1','5','8') LIMIT 1
	</select>
	
	<!--4，9，11 转规则  更新 -->
	<select id="INSBFlowerror_updateMydata_GZ" parameterType="Map">
		update INSBFlowerror  
		set modifytime = NOW(),flowcode=CONCAT('1_',flowcode)
	    where taskid = #{taskid} and inscomcode = #{inscomcode} and firoredi = #{firoredi} and flowcode in('4','9','11')
	</select>
	<!--1，5，8 转人工  更新 -->
	<select id="INSBFlowerror_updateMydata_RG" parameterType="Map">
		update INSBFlowerror  
		set modifytime = NOW(),flowcode=CONCAT('1_',flowcode)
	    where taskid = #{taskid} and inscomcode = #{inscomcode} and firoredi = #{firoredi} and flowcode in('1','5','8')
	</select>
	
	
	<!-- 6 非费改地区 走人工规则报价-->
	<select id="INSBFlowerror_selectMydataOneFfg" parameterType="Map" resultType="int">
		select count(*) from INSBFlowerror where taskid = #{taskid} and inscomcode = #{inscomcode} and firoredi = #{firoredi} and flowcode = '6' LIMIT 1
	</select>
	
	<!-- flowcode 0,2,3,10,5,1_5-->
	<select id="INSBFlowerror_selectOneTipGuizeshow" parameterType="Map" resultType="com.zzb.cm.entity.INSBFlowerror">
		select * from INSBFlowerror where taskid = #{taskid} and inscomcode = #{inscomcode} and firoredi = #{firoredi} and flowcode in('0','2','3','10','5','1_5') and errordesc IS NOT NULL and errordesc &lt;&gt; 'null' 
	</select>
	
</mapper>