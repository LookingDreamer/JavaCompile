<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zzb.cm.entity">
	<!-- INSBOrder  -->
	
	<select id="INSBOrder_insert" parameterType="com.zzb.cm.entity.INSBOrder" resultType="int">
		insert into INSBOrder
		(id,operator,createtime,modifytime,noti,taskid,orderno,orderstatus,paymentstatus,deliverystatus,buyway,agentcode,agentname,inputusercode,currency,totaldeliveryamount,totalpaymentamount,totalproductamount,totalpromotionamount,deptcode,paymentmethod,prvid,insorderno) 
		values
		(#{id},#{operator},#{createtime},#{modifytime},#{noti},#{taskid},#{orderno},#{orderstatus},#{paymentstatus},#{deliverystatus},#{buyway},#{agentcode},#{agentname},#{inputusercode},#{currency},#{totaldeliveryamount},#{totalpaymentamount},#{totalproductamount},#{totalpromotionamount},#{deptcode},#{paymentmethod},#{prvid},#{insorderno})
	</select>
	<select id="INSBOrder_select" parameterType="Map" resultType="com.zzb.cm.entity.INSBOrder">
		select * from INSBOrder
		<where>
			<if test="taskid != null">
				and taskid = #{taskid}
			</if>
			<if test="orderno != null">
				and orderno = #{orderno}
			</if>
			<if test="orderstatus != null">
				and orderstatus = #{orderstatus}
			</if>
			<if test="paymentstatus != null">
				and paymentstatus = #{paymentstatus}
			</if>
			<if test="deliverystatus != null">
				and deliverystatus = #{deliverystatus}
			</if>
			<if test="buyway != null">
				and buyway = #{buyway}
			</if>
			<if test="agentcode != null">
				and agentcode = #{agentcode}
			</if>
			<if test="agentname != null">
				and agentname = #{agentname}
			</if>
			<if test="inputusercode != null">
				and inputusercode = #{inputusercode}
			</if>
			<if test="currency != null">
				and currency = #{currency}
			</if>
			<if test="totaldeliveryamount != null">
				and totaldeliveryamount = #{totaldeliveryamount}
			</if>
			<if test="totalpaymentamount != null">
				and totalpaymentamount = #{totalpaymentamount}
			</if>
			<if test="totalproductamount != null">
				and totalproductamount = #{totalproductamount}
			</if>
			<if test="totalpromotionamount != null">
				and totalpromotionamount = #{totalpromotionamount}
			</if>
			<if test="deptcode != null">
				and deptcode = #{deptcode}
			</if>
			<if test="paymentmethod != null">
				and paymentmethod = #{paymentmethod}
			</if>
			<if test="prvid != null">
				and prvid = #{prvid}
			</if>
		</where>
	</select>
	
	<select id="INSBOrder_selectOne" parameterType="Map" resultType="com.zzb.cm.entity.INSBOrder">
		select * from INSBOrder
		<where>
			<if test="taskid != null">
				and taskid = #{taskid}
			</if>
			<if test="orderno != null">
				and orderno = #{orderno}
			</if>
			<if test="orderstatus != null">
				and orderstatus = #{orderstatus}
			</if>
			<if test="paymentstatus != null">
				and paymentstatus = #{paymentstatus}
			</if>
			<if test="deliverystatus != null">
				and deliverystatus = #{deliverystatus}
			</if>
			<if test="buyway != null">
				and buyway = #{buyway}
			</if>
			<if test="agentcode != null">
				and agentcode = #{agentcode}
			</if>
			<if test="agentname != null">
				and agentname = #{agentname}
			</if>
			<if test="inputusercode != null">
				and inputusercode = #{inputusercode}
			</if>
			<if test="currency != null">
				and currency = #{currency}
			</if>
			<if test="totaldeliveryamount != null">
				and totaldeliveryamount = #{totaldeliveryamount}
			</if>
			<if test="totalpaymentamount != null">
				and totalpaymentamount = #{totalpaymentamount}
			</if>
			<if test="totalproductamount != null">
				and totalproductamount = #{totalproductamount}
			</if>
			<if test="totalpromotionamount != null">
				and totalpromotionamount = #{totalpromotionamount}
			</if>
			<if test="deptcode != null">
				and deptcode = #{deptcode}
			</if>
			<if test="paymentmethod != null">
				and paymentmethod = #{paymentmethod}
			</if>
			<if test="prvid != null">
				and prvid = #{prvid}
			</if>
		</where>
		LIMIT 2
	</select>
	<select id="INSBOrder_selectById" parameterType="String" resultType="com.zzb.cm.entity.INSBOrder">
		select * from INSBOrder where id = #{id}
	</select>
	<select id="INSBOrder_selectByTaskId" parameterType="Map" resultType="com.zzb.cm.entity.INSBOrder">
		select o.*,p.paychannelname from INSBOrder o LEFT JOIN insbpaychannel p on o.paymentmethod=p.id  where taskid = #{taskid} and prvid = #{inscomcode}
	</select>
	<select id="INSBOrder_deleteById" parameterType="String">
		delete from INSBOrder where id = #{id}
	</select>
	<select id="INSBOrder_updateById" parameterType="com.zzb.cm.entity.INSBOrder">
 
		update INSBOrder  set <if test="customerinsurecode != null and customerinsurecode != ''">customerinsurecode = #{customerinsurecode},</if>operator = #{operator},modifytime = NOW(),noti = #{noti},taskid = #{taskid},orderno = #{orderno},orderstatus = #{orderstatus},paymentstatus = #{paymentstatus},deliverystatus = #{deliverystatus},buyway = #{buyway},agentcode = #{agentcode},agentname = #{agentname},inputusercode = #{inputusercode},currency = #{currency},totaldeliveryamount = #{totaldeliveryamount},totalpaymentamount = #{totalpaymentamount},totalproductamount = #{totalproductamount},totalpromotionamount = #{totalpromotionamount},deptcode = #{deptcode},paymentmethod = #{paymentmethod},prvid = #{prvid},insorderno=#{insorderno} where id = #{id}
 
	</select>
	<select id="INSBOrder_selectCount" parameterType="Map" resultType="Long">
		select count(1) from INSBOrder
		<where>
			<if test="taskid != null">
				and taskid = #{taskid}
			</if>
			<if test="orderno != null">
				and orderno = #{orderno}
			</if>
			<if test="orderstatus != null">
				and orderstatus = #{orderstatus}
			</if>
			<if test="paymentstatus != null">
				and paymentstatus = #{paymentstatus}
			</if>
			<if test="deliverystatus != null">
				and deliverystatus = #{deliverystatus}
			</if>
			<if test="buyway != null">
				and buyway = #{buyway}
			</if>
			<if test="agentcode != null">
				and agentcode = #{agentcode}
			</if>
			<if test="agentname != null">
				and agentname = #{agentname}
			</if>
			<if test="inputusercode != null">
				and inputusercode = #{inputusercode}
			</if>
			<if test="currency != null">
				and currency = #{currency}
			</if>
			<if test="totaldeliveryamount != null">
				and totaldeliveryamount = #{totaldeliveryamount}
			</if>
			<if test="totalpaymentamount != null">
				and totalpaymentamount = #{totalpaymentamount}
			</if>
			<if test="totalproductamount != null">
				and totalproductamount = #{totalproductamount}
			</if>
			<if test="totalpromotionamount != null">
				and totalpromotionamount = #{totalpromotionamount}
			</if>
			<if test="deptcode != null">
				and deptcode = #{deptcode}
			</if>
			<if test="paymentmethod != null">
				and paymentmethod = #{paymentmethod}
			</if>
			<if test="prvid != null">
				and prvid = #{prvid}
			</if>
		</where>
	</select>
	<select id="INSBOrder_selectOrderManageCode" parameterType="map" resultType="Map" resultMap="myTaskResult">
		select m.*,p.insuredname,p.premium,p.risktype,p.team,p.proposalformno,p.agentname,dc.shortname from ((
			select m.taskcode,ic.codename,m.instanceid,cari.carlicenseno,m.createtime,q.inscomcode,p.prvname,d.orderstatus
		 FROM insbworkflowmain m,insbworkflowsub s,
		 	  insbprovider p,insbquoteinfo q ,insccode ic,insbcarinfo cari,insborder d,insbinsured f,insbperson man,insbagent gs
		<where>
		m.taskcode in ("23","27","24")
		AND m.operator is null
		AND m.instanceid = s.maininstanceid
		AND q.workflowinstanceid = s.instanceid
		AND q.inscomcode = p.prvcode
		AND ic.codetype ='workflowNodelName'
		AND ic.codevalue = m.taskcode
		AND cari.taskid = m.instanceid
		AND m.instanceid =d.taskid
		AND q.inscomcode=d.prvid
		AND m.instanceid=f.taskid
		AND f.personid=man.id
		AND gs.agentcode=d.agentcode
		AND d.orderstatus !=0
		<if test="orderstatus!=null">
		AND	d.orderstatus=#{orderstatus}
		</if>
		<if test="agentname!=null">
		AND	gs.name like CONCAT(#{agentname},'%')
		</if>
		<if test="agentnum!=null">
		AND	gs.jobnum=#{agentnum}
		</if>
		<if test="proposalformno!=null">
		AND	p.proposalformno=#{proposalformno}
		</if>
		<if test="carlicenseno!=null">
		AND	cari.carlicenseno=#{carlicenseno}
		</if>
		<if test="prvid!=null">
		AND	q.inscomcode =#{prvid}
		</if>
		<if test="qsimple!=null">
		AND	(man.name like CONCAT(#{qsimple},'%') or cari.carlicenseno=#{qsimple})
		</if>
		<if test="insuredname!=null">
		AND	 man.name like CONCAT(#{insuredname},'%')
		</if>
		<if test="phonenumber!=null">
		AND	cari.phonenumber=#{phonenumber}
		</if>
		<if test= "startdate != null and startdate !=''">
		AND m.createtime <![CDATA[ >= ]]>DATE_FORMAT( #{startdate}, '%Y-%m-%d %H:%i:%S')
		</if>
		<if test= "enddate != null and enddate !=''">
		AND m.createtime<![CDATA[ <= ]]> DATE_FORMAT( #{enddate}, '%Y-%m-%d %H:%i:%S') 
		</if>
		<if test="instanceid!=null">
		AND	m.instanceid=#{instanceid}
		</if>
		</where>
		)UNION(select s.taskcode,ic.codename,m.instanceid,cari.carlicenseno,m.createtime,q.inscomcode,p.prvname,d.orderstatus
		 FROM insbworkflowmain m,insbworkflowsub s,
		 	  insbprovider p,insbquoteinfo q ,insccode ic,insbcarinfo cari,insborder d,insbinsured f,insbperson man,insbagent gs
		<where>
		d.orderstatus !=0
		AND m.taskcode in("2","15")
		AND s.taskcode="20"
		AND m.instanceid = s.maininstanceid
		AND q.workflowinstanceid = s.instanceid
		AND q.inscomcode = p.prvcode
		AND codetype ='workflowNodelName'
		AND ic.codevalue = m.taskcode
		AND cari.taskid = m.instanceid
		AND m.instanceid =d.taskid
		AND q.inscomcode=d.prvid
		AND m.instanceid=f.taskid
		AND f.personid=man.id
		AND gs.agentcode=d.agentcode
		<if test="orderstatus!=null">
		AND	d.orderstatus=#{orderstatus}
		</if>
		<if test="agentname!=null">
		AND	gs.name like CONCAT(#{agentname},'%')
		</if>
		<if test="agentnum!=null">
		AND	gs.jobnum=#{agentnum}
		</if>
		<if test="proposalformno!=null">
		AND	p.proposalformno=#{proposalformno}
		</if>
		<if test="carlicenseno!=null">
		AND	cari.carlicenseno=#{carlicenseno}
		</if>
		<if test="prvid!=null">
		AND	q.inscomcode =#{prvid}
		</if>
		<if test="qsimple!=null">
		AND	(man.name like CONCAT(#{qsimple},'%') or cari.carlicenseno=#{qsimple})
		</if>
		<if test="insuredname!=null">
		AND	 man.name like CONCAT(#{insuredname},'%')
		</if>
		<if test="phonenumber!=null">
		AND	cari.phonenumber=#{phonenumber}
		</if>
		<if test= "startdate != null and startdate !=''">
		AND m.createtime <![CDATA[ >= ]]>DATE_FORMAT( #{startdate}, '%Y-%m-%d %H:%i:%S')
		</if>
		<if test= "enddate != null and enddate !=''">
		AND m.createtime<![CDATA[ <= ]]> DATE_FORMAT( #{enddate}, '%Y-%m-%d %H:%i:%S') 
		</if>
		<if test="instanceid!=null">
		AND	m.instanceid=#{instanceid}
		</if>
		</where>
		)UNION(	select '999',a.mobile,c.id,a.name,c.createtime,a.jobnum,r.comcodename,c.mainbiz as carlicenseno 
       	FROM insbgroupmembers gm ,insbbusinessmanagegroup gp, insbcertification c  LEFT JOIN insbagent a ON a.tempjobnum = c.agentnum LEFT JOIN insbregion r ON r.id = a.livingcityid 
       	<where>
        c.status ='0' and c.designatedoperator is null
        AND gm.groupid=gp.id AND gp.tasktype LIKE CONCAT('%',"h",'%')
        AND gm.userid=#{userId}
       	<if test="orderstatus!=null">
       	AND 'orderstatus'=#{orderstatus}
       	</if>
       	<if test="instanceid!=null">
		AND	'instanceid'=#{instanceid}
		</if>
		<if test="agentname!=null">
		AND	a.name like CONCAT(#{agentname},'%')
		</if>
		<if test="agentnum!=null">
		AND	a.jobnum=#{agentnum}
		</if>
		<if test="prvid!=null">
		AND	'prvname' =#{prvid}
		</if>
		<if test="phonenumber!=null">
		AND	a.mobile=#{phonenumber}
		</if>
		<if test= "startdate != null and startdate !=''">
		AND c.createtime <![CDATA[ >= ]]>DATE_FORMAT( #{startdate}, '%Y-%m-%d %H:%i:%S')
		</if>
		<if test= "enddate != null and enddate !=''">
		AND c.createtime<![CDATA[ <= ]]> DATE_FORMAT( #{enddate}, '%Y-%m-%d %H:%i:%S') 
		</if>
		<if test="carlicenseno!=null">
		AND	c.mainbiz like CONCAT(#{carlicenseno},'%')
		</if>
		<if test="qsimple!=null">
		AND	('insuredname' like CONCAT(#{qsimple},'%') or c.mainbiz like CONCAT(#{qsimple},'%'))
		</if>
		<if test="insuredname!=null">
		AND	 'insuredname' = CONCAT(#{insuredname},'%')
		</if>
		</where>
       	)ORDER BY createtime DESC limit #{limit},#{pageSize}) m 
       	left join insbpolicyitem p on p.taskid = m.instanceid and m.inscomcode=p.inscomcode
       	LEFT JOIN insbquotetotalinfo qt ON qt.taskid=m.instanceid 
		LEFT JOIN insbagent g ON qt.agentnum=g.jobnum
		LEFT JOIN inscdept dc ON dc.comcode=g.deptid
       	<where>
		<if test="insuredname!=null">
		AND p.insuredname like CONCAT(#{insuredname},'%')
		</if>
      	<if test="qsimple!=null">
		AND	(p.insuredname like CONCAT(#{qsimple},'%') or m.carlicenseno like CONCAT(#{qsimple},'%'))
		</if>
		<if test="usertype!=null">
		AND g.jobnumtype =#{usertype}
		</if>
		
       </where> 
       ORDER BY m.createtime DESC
	</select>
	 <resultMap id="myTaskResult" type="Map">
	 	<result property="inscomcode" column="inscomcode"/>
	 	<result property="codename" column="codename"/>
	 	<result property="instanceid" column="instanceid"/>
	 	<result property="taskid" column="taskid"/>
	 	<result property="taskcode" column="taskcode"/>
	 	<result property="createtime" column="createtime"/>
	 	<result property="inscomname" column="inscomname"/>
	 	<result property="prvname" column="prvname"/>
	 	<result property="carlicenseno" column="carlicenseno"/>
		<result property="shortname" column="shortname"/>
	 	<result property="team" column="team"/>
	 	<result property="insurancearea" column="insurancearea"/>
	 	<result property="insuredname" column="insuredname"/>
	 	<result property="remark" column="remark"/>
	 	<result property="commentcontent" column="commentcontent"/>
	 	<result property="jobnumtype" column="jobnumtype"/> 
	 	<result property="agentnum" column="agentnum"/> 
	 	<result property="agentname" column="agentname"/> 
	 	<result property="delivetype" column="delivetype"/> 
	 	<result property="paychannelname" column="paychannelname"/> 
	 	<result property="paynum" column="paynum"/> 
	 	<result property="orderstatus" column="orderstatus"/> 
	 	<result property="deptcode" column="deptcode"/> 
	 	<result property="deptname" column="deptname"/> 
	 	<collection property="policyInfo"  ofType="Map" javaType="List">
            <result property="risktype" column="risktype"/>
            <result property="premium" column="premium"/>
            <result property="paynum" column="paynum"/>
            <result property="proposalformno" column="proposalformno"/>
	 	</collection>
	 </resultMap>
	<select id="INSBOrder_selectOrderManageCount" parameterType="map" resultType="Long">
	select  m.taskcode,ic.codename,m.instanceid,cari.carlicenseno,m.createtime,
		q.inscomcode,p.prvname,man.name,d.orderstatus,dc.shortname
		FROM insbworkflowmain m,insbworkflowsub s,insbprovider p,insbquoteinfo q ,insccode ic,insbcarinfo cari,
		insbinsured f,insborder d,inscdept dc,insbperson man,insbagent gs
		WHERE
		m.taskcode in ("23","27","24") 
		AND m.operator is null
		AND m.instanceid = s.maininstanceid
		AND q.workflowinstanceid = s.instanceid
		AND q.inscomcode = p.prvcode
		AND ic.codetype ='workflowNodelName'
		AND ic.codevalue = m.taskcode
		AND cari.taskid = m.instanceid
		AND m.instanceid =d.taskid
		AND q.inscomcode=d.prvid
		AND d.deptcode=dc.comcode
		AND m.instanceid=f.taskid
		AND f.personid=man.id
		AND gs.agentcode=d.agentcode
		AND d.orderstatus !=0
		<if test="orderstatus!=null">
		AND	d.orderstatus=#{orderstatus}
		</if>
		<if test="agentname!=null">
		AND	gs.name like CONCAT(#{agentname},'%')
		</if>
		<if test="agentnum!=null">
		AND	gs.jobnum=#{agentnum}
		</if>
		<if test="usertype!=null">
		AND	gs.jobnumtype=#{usertype}
		</if>
		<if test="carlicenseno!=null">
		AND	cari.carlicenseno=#{carlicenseno}
		</if>
		<if test="qsimple!=null">
		AND	(man.name like CONCAT(#{qsimple},'%') or cari.carlicenseno=#{qsimple})
		</if>
		<if test="insuredname!=null">
		AND	 man.name like CONCAT(#{insuredname},'%')
		</if>
		<if test="prvid!=null">
		AND	q.inscomcode =#{prvid}
		</if>
		<if test="phonenumber!=null">
		AND	cari.phonenumber=#{phonenumber}
		</if>
		<if test= "startdate != null and startdate !=''">
		AND m.createtime <![CDATA[ >= ]]>DATE_FORMAT( #{startdate}, '%Y-%m-%d %H:%i:%S')
		</if>
		<if test= "enddate != null and enddate !=''">
		AND m.createtime<![CDATA[ <= ]]> DATE_FORMAT( #{enddate}, '%Y-%m-%d %H:%i:%S') 
		</if>
		<if test="instanceid!=null">
		AND	m.instanceid=#{instanceid}
		</if>
		UNION(select  s.taskcode,ic.codename,m.instanceid,cari.carlicenseno,m.createtime,
		q.inscomcode,p.prvname,man.name,d.orderstatus,dc.shortname
		FROM insbworkflowmain m,insbworkflowsub s,insbprovider p,insbquoteinfo q ,insccode ic,insbcarinfo cari,
		insbinsured f,insborder d,inscdept dc,insbperson man,insbagent gs
		WHERE
		m.taskcode in("2","15")
		AND s.taskcode="20"
		AND m.instanceid = s.maininstanceid
		AND q.workflowinstanceid = s.instanceid
		AND q.inscomcode = p.prvcode
		AND ic.codetype ='workflowNodelName'
		AND ic.codevalue = m.taskcode
		AND cari.taskid = m.instanceid
		AND m.instanceid =d.taskid
		AND q.inscomcode=d.prvid
		AND d.deptcode=dc.comcode
		AND m.instanceid=f.taskid
		AND f.personid=man.id
		AND gs.agentcode=d.agentcode
		AND d.orderstatus !=0
		<if test="orderstatus!=null">
		AND	d.orderstatus=#{orderstatus}
		</if>
		<if test="agentname!=null">
		AND	gs.name like CONCAT(#{agentname},'%')
		</if>
		<if test="agentnum!=null">
		AND	gs.jobnum=#{agentnum}
		</if>
		<if test="usertype!=null">
		AND	gs.jobnumtype=#{usertype}
		</if>
		<if test="carlicenseno!=null">
		AND	cari.carlicenseno=#{carlicenseno}
		</if>
		<if test="qsimple!=null">
		AND	(man.name like CONCAT(#{qsimple},'%') or cari.carlicenseno=#{qsimple})
		</if>
		<if test="insuredname!=null">
		AND	 man.name like CONCAT(#{insuredname},'%')
		</if>
		<if test="prvid!=null">
		AND	q.inscomcode =#{prvid}
		</if>
		<if test="phonenumber!=null">
		AND	cari.phonenumber=#{phonenumber}
		</if>
		<if test= "startdate != null and startdate !=''">
		AND m.createtime <![CDATA[ >= ]]>DATE_FORMAT( #{startdate}, '%Y-%m-%d %H:%i:%S')
		</if>
		<if test= "enddate != null and enddate !=''">
		AND m.createtime<![CDATA[ <= ]]> DATE_FORMAT( #{enddate}, '%Y-%m-%d %H:%i:%S') 
		</if>
		<if test="instanceid!=null">
		AND	m.instanceid=#{instanceid}
		</if>
		)
		UNION (select '999',a.mobile,'instanceid',c.mainbiz as carlicenseno,
		c.createtime,a.jobnum,'operator','insuredname',r.comcodename,'orderstatus'
       	FROM insbgroupmembers gm ,insbbusinessmanagegroup gp,insbcertification c  LEFT JOIN insbagent a ON a.tempjobnum = c.agentnum LEFT JOIN insbregion r ON r.id = a.livingcityid where c.status ='0' 
       	and (c.designatedoperator is null or c.designatedoperator='') and gm.userid=#{userId}
							AND gm.groupid=gp.id AND gp.tasktype LIKE CONCAT('%',"h",'%')
							
        <if test="usertype!=null">
       	AND a.jobnumtype=#{usertype}
       	</if>
       	<if test="agentname!=null">
		AND	a.name like CONCAT(#{agentname},'%')
		</if>
		<if test="agentnum!=null">
		AND	a.jobnum=#{agentnum}
		</if>
       	<if test="orderstatus!=null">
       	AND 'orderstatus'=#{orderstatus}
       	</if>
       	<if test="instanceid!=null">
		AND	'instanceid'=#{instanceid}
		</if>
		<if test="prvid!=null">
		AND	'prvname' =#{prvid}
		</if>
		<if test="phonenumber!=null">
		AND	a.mobile =#{phonenumber}
		</if>
		<if test= "startdate != null and startdate !=''">
		AND c.createtime <![CDATA[ >= ]]>DATE_FORMAT( #{startdate}, '%Y-%m-%d %H:%i:%S')
		</if>
		<if test= "enddate != null and enddate !=''">
		AND c.createtime<![CDATA[ <= ]]> DATE_FORMAT( #{enddate}, '%Y-%m-%d %H:%i:%S') 
		</if>
		<if test="insuredname!=null">
		AND	 'insuredname' like CONCAT(#{insuredname},'%')
		</if>
		<if test="carlicenseno!=null">
		AND	c.mainbiz like CONCAT(#{carlicenseno},'%')
		</if>
		<if test="qsimple!=null">
		AND	('insuredname' like CONCAT(#{qsimple},'%') or c.mainbiz like CONCAT(#{qsimple},'%'))
		</if>
        )
	) g 
	
	</select>
	<select id="INSBOrder_selectByPrvidLike" parameterType="com.zzb.cm.entity.INSBOrder" resultType="com.zzb.cm.entity.INSBOrder">
		select * from INSBOrder
		<where>
			<if test="taskid != null">
				and taskid = #{taskid}
			</if>
			<if test="orderno != null">
				and orderno = #{orderno}
			</if>
			<if test="orderstatus != null">
				and orderstatus = #{orderstatus}
			</if>
			<if test="paymentstatus != null">
				and paymentstatus = #{paymentstatus}
			</if>
			<if test="deliverystatus != null">
				and deliverystatus = #{deliverystatus}
			</if>
			<if test="buyway != null">
				and buyway = #{buyway}
			</if>
			<if test="agentcode != null">
				and agentcode = #{agentcode}
			</if>
			<if test="agentname != null">
				and agentname = #{agentname}
			</if>
			<if test="inputusercode != null">
				and inputusercode = #{inputusercode}
			</if>
			<if test="currency != null">
				and currency = #{currency}
			</if>
			<if test="totaldeliveryamount != null">
				and totaldeliveryamount = #{totaldeliveryamount}
			</if>
			<if test="totalpaymentamount != null">
				and totalpaymentamount = #{totalpaymentamount}
			</if>
			<if test="totalproductamount != null">
				and totalproductamount = #{totalproductamount}
			</if>
			<if test="totalpromotionamount != null">
				and totalpromotionamount = #{totalpromotionamount}
			</if>
			<if test="deptcode != null">
				and deptcode like CONCAT(#{deptcode},'%')
			</if>
			<if test="paymentmethod != null">
				and paymentmethod = #{paymentmethod}
			</if>
			<if test="prvid != null">
				and prvid like CONCAT(#{prvid},'%')
			</if>
		</where>
	</select>
	<select id="INSBOrder_queryOrder" parameterType ="Map" resultType="com.zzb.cm.entity.INSBOrder">
		select  * FROM insborder o 
		<where>
			<if test="taskid!=null">
				AND o.taskid = #{taskid}
			</if>
			<if test="prvid!=null">
				AND o.prvid = #{prvid}
			</if>
		</where>
		LIMIT 1
	</select>
	<select id="INSBOrder_queryOrderByid" parameterType ="String" resultType="com.zzb.cm.entity.INSBOrder">
		select o.*,d.comname deptshortname,v.delivetype FROM insborder o LEFT JOIN inscdept d ON d.id = o.deptcode 
		LEFT JOIN insborderdelivery v ON v.taskid = o.taskid  and v.providerid=#{providerid}  WHERE o.id =#{orderid}   limit 1 
	</select>
	
	<!-- 任务管理页面查询任务列表  liuchao -->
	<select id="INSBOrder_selectOrderManageCode01" parameterType="Map" resultType="Map">
		select 
		re.taskcode, 
		DATE_FORMAT(re.taskcreatetime,'%Y-%m-%d %H:%i:%S') AS taskcreatetime, 
		re.mInstanceid, 
		re.sInstanceid, 
		re.inscomcode, 
		re.mainOrsub, 
		re.carlicenseno, 
		re.insuredName, 
		re.agentname, 
		re.agentnum, 
		re.team, 
		re.inscomname, 
		re.deptname, 
		re.orderstatus, 
		re.buychannel, 
		re.busdischarge, 
		re.busproposalformno, 
		re.buspolicyno, 
		re.strdischarge, 
		re.strproposalformno, 
		re.strpolicyno, 
		re.jobnumtype, 
		re.phone, 
		re.paychannelname,
		(select l.channelname from insbchannel l where channelinnercode=re.purchaserchannel and childflag='1' and (deleteflag is NULL OR deleteflag !='0') ) AS purchaserchannel
		FROM (((
			select wm.taskcode AS taskcode, wm.instanceid AS mInstanceid, mws.instanceid AS sInstanceid, mq.inscomcode AS inscomcode,
				(select MAX(wmt.createtime) FROM insbworkflowmaintrack wmt WHERE wmt.instanceid=wm.instanceid and wmt.taskcode=wm.taskcode and wmt.taskstate in ('Reserved', 'Ready')) AS taskcreatetime,
				'1' AS mainOrsub,
				CASE WHEN mch.carlicenseno IS NULL THEN mc.carlicenseno ELSE mch.carlicenseno END AS carlicenseno,
				CASE WHEN mihp.`name` IS NULL THEN mip.`name` ELSE mihp.`name` END AS insuredName,
				mqt.agentname AS agentname, mqt.agentnum AS agentnum, mqt.team AS team, mqt.purchaserchannel,
				mpr.prvname AS inscomname, md.shortname AS deptname, mcc.codename AS orderstatus, 
				CASE WHEN mq.buybusitype='02' THEN '网销' WHEN mq.buybusitype='03' THEN '电销' ELSE '传统' END AS buychannel, 
				ROUND(mbp.discountCharge, 2) AS busdischarge, mbp.proposalformno AS busproposalformno, mbp.policyno AS buspolicyno, 
				ROUND(msp.discountCharge, 2) AS strdischarge, msp.proposalformno AS strproposalformno, msp.policyno AS strpolicyno, magt.jobnumtype AS jobnumtype, 
				magt.phone AS phone, mpaych.paychannelname AS paychannelname 
			FROM insbworkflowmain wm 
			LEFT JOIN insbinsured mi ON wm.instanceid=mi.taskid 
			LEFT JOIN insbperson mip ON mip.id=mi.personid 
			LEFT JOIN insbquotetotalinfo mqt ON mqt.taskid=wm.instanceid 
			LEFT JOIN insbagent magt ON mqt.agentnum=magt.jobnum 
			LEFT JOIN insbworkflowsub mws ON mws.maininstanceid=wm.instanceid AND mws.taskstate!='Closed' 
			LEFT JOIN insbquoteinfo mq ON mq.workflowinstanceid=mws.instanceid AND mq.quotetotalinfoid=mqt.id 
			LEFT JOIN insbpolicyitem mbp ON mbp.taskid=wm.instanceid AND mbp.inscomcode=mq.inscomcode AND mbp.risktype='0' 
			LEFT JOIN insbpolicyitem msp ON msp.taskid=wm.instanceid AND msp.inscomcode=mq.inscomcode AND msp.risktype='1' 
			LEFT JOIN insborder mo ON mo.taskid=wm.instanceid AND mo.prvid=mq.inscomcode 
			LEFT JOIN inscdept md ON md.comcode=mq.deptcode 
			LEFT JOIN insbprovider mpr ON mpr.prvcode=mq.inscomcode 
			LEFT JOIN insbcarinfo mc ON mc.taskid=wm.instanceid 
			LEFT JOIN insbcarmodelinfo mcm ON mcm.carinfoid=mc.id 
			LEFT JOIN insbinsuredhis mih ON mih.taskid=wm.instanceid AND mih.inscomcode=mq.inscomcode 
			LEFT JOIN insbperson mihp ON mihp.id=mih.personid 
			LEFT JOIN insbcarinfohis mch ON mch.taskid=wm.instanceid AND mch.inscomcode=mq.inscomcode 
			LEFT JOIN insbcarmodelinfohis mcmh ON mcmh.carinfoid=mc.id AND mcmh.inscomcode=mq.inscomcode 
			LEFT JOIN insccode mcc ON mcc.codetype='orderstatus' AND mcc.parentcode='orderstatus' AND mcc.codevalue=mo.orderstatus
			LEFT JOIN insbpaychannel mpaych ON mpaych.id=mo.paymentmethod 
			LEFT JOIN inscdept mdept ON mdept.comcode=mq.deptcode 
			WHERE (wm.operator='' OR wm.operator IS NULL) AND wm.taskcode IN('23','24','27','28') 
				AND (mdept.parentcodes LIKE CONCAT('%', #{userorganization},'%') OR mdept.comcode=#{userorganization}) 
				AND EXISTS(select * FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
				WHERE qxgm.userid=#{loginUserId} AND ((wm.taskcode='27' AND qxmg.tasktype LIKE CONCAT('%',"b",'%')) 
					OR (wm.taskcode='28' AND qxmg.tasktype LIKE CONCAT('%',"c",'%')) OR (wm.taskcode='23' OR wm.taskcode='24'))))
		
			UNION(
			select ws.taskcode AS taskcode, ws.maininstanceid AS mInstanceid, ws.instanceid AS sInstanceid, sq.inscomcode AS inscomcode,
				(select MAX(wst.createtime) FROM insbworkflowsubtrack wst WHERE wst.maininstanceid=ws.maininstanceid and wst.instanceid=ws.instanceid and wst.taskcode=ws.taskcode and wst.taskstate in ('Reserved', 'Ready')) AS taskcreatetime,
				'2' AS mainOrsub, 
				CASE WHEN sch.carlicenseno IS NULL THEN sc.carlicenseno ELSE sch.carlicenseno END AS carlicenseno,
				CASE WHEN sihp.`name` IS NULL THEN sip.`name` ELSE sihp.`name` END AS insuredName,
				sqt.agentname AS agentname, sqt.agentnum AS agentnum, sqt.team AS team,  sqt.purchaserchannel,
				spr.prvname AS inscomname, sd.shortname AS deptname, scc.codename AS orderstatus, 
				CASE WHEN sq.buybusitype='02' THEN '网销' WHEN sq.buybusitype='03' THEN '电销' ELSE '传统' END AS buychannel, 
				ROUND(sbp.premium, 2) AS busdischarge, sbp.proposalformno AS busproposalformno, sbp.policyno AS buspolicyno, 
				ROUND(ssp.premium, 2) AS strdischarge, ssp.proposalformno AS strproposalformno, ssp.policyno AS strpolicyno, sagt.jobnumtype AS jobnumtype, 
				sagt.phone AS phone, wpaych.paychannelname AS paychannelname 
			FROM insbworkflowsub ws 
			LEFT JOIN insbinsured si ON ws.maininstanceid=si.taskid 
			LEFT JOIN insbperson sip ON sip.id=si.personid 
			LEFT JOIN insbquotetotalinfo sqt ON sqt.taskid=ws.maininstanceid 
			LEFT JOIN insbagent sagt ON sqt.agentnum=sagt.jobnum 
			LEFT JOIN insbworkflowmain swm ON swm.instanceid=ws.maininstanceid 
			LEFT JOIN insbquoteinfo sq ON sq.workflowinstanceid=ws.instanceid AND sq.quotetotalinfoid=sqt.id 
			LEFT JOIN insbpolicyitem sbp ON sbp.taskid=ws.maininstanceid AND sbp.inscomcode=sq.inscomcode AND sbp.risktype='0' 
			LEFT JOIN insbpolicyitem ssp ON ssp.taskid=ws.maininstanceid AND ssp.inscomcode=sq.inscomcode AND ssp.risktype='1' 
			LEFT JOIN insborder so ON so.taskid=ws.maininstanceid AND so.prvid=sq.inscomcode 
			LEFT JOIN inscdept sd ON sd.comcode=sq.deptcode 
			LEFT JOIN insbprovider spr ON spr.prvcode=sq.inscomcode 
			LEFT JOIN insbcarinfo sc ON sc.taskid=ws.maininstanceid 
			LEFT JOIN insbcarmodelinfo scm ON scm.carinfoid=sc.id 
			LEFT JOIN insbinsuredhis sih ON sih.taskid=ws.maininstanceid AND sih.inscomcode=sq.inscomcode 
			LEFT JOIN insbperson sihp ON sihp.id=sih.personid 
			LEFT JOIN insbcarinfohis sch ON sch.taskid=ws.maininstanceid AND sch.inscomcode=sq.inscomcode 
			LEFT JOIN insbcarmodelinfohis scmh ON scmh.carinfoid=sc.id AND scmh.inscomcode=sq.inscomcode 
			LEFT JOIN insccode scc ON scc.codetype='orderstatus' AND scc.parentcode='orderstatus' AND scc.codevalue=so.orderstatus
			LEFT JOIN insbpaychannel wpaych ON wpaych.id=so.paymentmethod 
			LEFT JOIN inscdept sdept ON sdept.comcode=sq.deptcode 
			WHERE swm.taskcode IN('2','15') AND ws.taskcode='20' AND (ws.operator='' OR ws.operator IS NULL OR ws.operator='admin')
				AND EXISTS(select * FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
				WHERE qxgm.userid=#{loginUserId} AND (qxmg.tasktype LIKE CONCAT('%',"9",'%')))
				AND (sdept.parentcodes LIKE CONCAT('%', #{userorganization},'%') OR sdept.comcode=#{userorganization}))) 
		
			UNION(
			select '999' AS taskcode, rc.id AS mInstanceid, rc.id AS sInstanceid, '' AS inscomcode, rc.createtime AS taskcreatetime,
				'3' AS mainOrsub, '' AS carlicenseno, '' AS insuredName, ra.`name` AS agentname, ra.jobnum AS agentnum, '' AS team, '' AS purchaserchannel,
				'' AS inscomname, rd.comname AS deptname, rc.`status` AS orderstatus, rcbus.codename AS buychannel, 
				'' AS busdischarge, rcc.comcodename AS busproposalformno, rcx.comcodename AS buspolicyno, 
				'' AS strdischarge, rcp.comcodename AS strproposalformno, '' AS strpolicyno, ra.jobnumtype AS jobnumtype, ra.phone AS phone, 
				'' AS paychannelname 
			FROM insbcertification rc 
			LEFT JOIN insccode rcbus ON rcbus.codetype='mainbusiness' AND rcbus.parentcode='mainbusiness' AND rcbus.codevalue=rc.mainbiz 
			LEFT JOIN insbagent ra ON ra.tempjobnum=rc.agentnum 
			LEFT JOIN inscdept rd ON rd.id=rc.deptid 
			LEFT JOIN insbregion rcp ON rcp.comcode=rd.province 
			LEFT JOIN insbregion rcc ON rcc.comcode=rd.city 
			LEFT JOIN insbregion rcx ON rcx.comcode=rd.county 
			WHERE rc.`status`=0 AND (rc.designatedoperator='' OR rc.designatedoperator IS NULL)
				AND EXISTS(select * FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
				WHERE qxgm.userid=#{loginUserId} AND qxmg.tasktype LIKE CONCAT('%',"h",'%'))
				AND (rd.parentcodes LIKE CONCAT('%', #{userorganization},'%') OR rd.comcode=#{userorganization}))) re
		<where>
			<if test="carlicensenoOrinsuredname != null">
			 	AND (re.carlicenseno LIKE CONCAT(#{carlicensenoOrinsuredname},'%')
			 	OR re.insuredName LIKE CONCAT(#{carlicensenoOrinsuredname},'%'))
			</if>
			<if test="taskstatus != null and taskstatus == '01'">
			 	AND re.taskcode = '20' 
			</if>
			<if test="taskstatus != null and taskstatus == '02'">
			 	AND re.taskcode IN ('23','27','28') 
			</if>
			<if test="taskstatus != null and taskstatus == '03'">
			 	AND re.taskcode = '24' 
			</if>
			<if test="taskstatus != null and taskstatus == '04'">
			 	AND re.taskcode = '999' 
			</if>
			<if test="insuredname != null">
			 	AND re.insuredName LIKE CONCAT(#{insuredname},'%')
			</if>
			<if test="agentName != null">
			 	AND re.agentname LIKE CONCAT(#{agentName},'%')
			</if>
			<if test="usertype != null">
			 	AND re.jobnumtype = #{usertype}
			</if>
			<if test="carlicenseno != null">
			 	AND re.carlicenseno=#{carlicenseno}
			</if>
			<if test="agentNum != null">
			 	AND re.agentnum = #{agentNum}
			</if>
			<if test="inscomcode != null">
			 	AND re.inscomcode = #{inscomcode}
			</if>
			<if test="agentphone != null">
			 	AND re.phone = #{agentphone}
			</if>
			<if test="maininstanceid != null">
			 	AND re.mInstanceid = #{maininstanceid}
			</if>
			<if test="taskcreatetimeup != null"> 
				AND re.taskcreatetime &gt;= DATE_FORMAT(#{taskcreatetimeup}, '%Y-%m-%d %H:%i:%S')
			</if>
			<if test="taskcreatetimedown != null">
			 	AND re.taskcreatetime &lt;= DATE_FORMAT(#{taskcreatetimedown}, '%Y-%m-%d %H:%i:%S')
			</if>
		</where>
       ORDER BY re.taskcreatetime DESC 
       LIMIT #{offset},#{limit}
	</select>
	<!-- 任务管理页面查询任务列表  liuchao -->
	<select id="INSBOrder_selectOrderManageCodeCount01" parameterType="Map" resultType="Long">
		select COUNT(1) 
		FROM (((
			select wm.taskcode AS taskcode, wm.instanceid AS mInstanceid, mws.instanceid AS sInstanceid, mq.inscomcode AS inscomcode,
				(select MAX(wmt.createtime) FROM insbworkflowmaintrack wmt WHERE wmt.instanceid=wm.instanceid and wmt.taskcode=wm.taskcode and wmt.taskstate in ('Reserved', 'Ready')) AS taskcreatetime,
				'1' AS mainOrsub, 
				CASE WHEN mch.carlicenseno IS NULL THEN mc.carlicenseno ELSE mch.carlicenseno END AS carlicenseno,
				CASE WHEN mihp.`name` IS NULL THEN mip.`name` ELSE mihp.`name` END AS insuredName,
				mqt.agentname AS agentname, mqt.agentnum AS agentnum, mqt.team AS team, 
				mpr.prvname AS inscomname, md.shortname AS deptname, mcc.codename AS orderstatus, 
				CASE WHEN mq.buybusitype='02' THEN '网销' WHEN mq.buybusitype='03' THEN '电销' ELSE '传统' END AS buychannel, 
				ROUND(mbp.premium, 2) AS busdischarge, mbp.proposalformno AS busproposalformno, mbp.policyno AS buspolicyno, 
				ROUND(msp.premium, 2) AS strdischarge, msp.proposalformno AS strproposalformno, msp.policyno AS strpolicyno, magt.jobnumtype AS jobnumtype, 
				magt.phone AS phone, mpaych.paychannelname AS paychannelname 
			FROM insbworkflowmain wm 
			LEFT JOIN insbinsured mi ON wm.instanceid=mi.taskid 
			LEFT JOIN insbperson mip ON mip.id=mi.personid 
			LEFT JOIN insbquotetotalinfo mqt ON mqt.taskid=wm.instanceid 
			LEFT JOIN insbagent magt ON mqt.agentnum=magt.jobnum 
			LEFT JOIN insbworkflowsub mws ON mws.maininstanceid=wm.instanceid AND mws.taskstate!='Closed' 
			LEFT JOIN insbquoteinfo mq ON mq.workflowinstanceid=mws.instanceid AND mq.quotetotalinfoid=mqt.id 
			LEFT JOIN insbpolicyitem mbp ON mbp.taskid=wm.instanceid AND mbp.inscomcode=mq.inscomcode AND mbp.risktype='0' 
			LEFT JOIN insbpolicyitem msp ON msp.taskid=wm.instanceid AND msp.inscomcode=mq.inscomcode AND msp.risktype='1' 
			LEFT JOIN insborder mo ON mo.taskid=wm.instanceid AND mo.prvid=mq.inscomcode 
			LEFT JOIN inscdept md ON md.comcode=mq.deptcode 
			LEFT JOIN insbprovider mpr ON mpr.prvcode=mq.inscomcode 
			LEFT JOIN insbcarinfo mc ON mc.taskid=wm.instanceid 
			LEFT JOIN insbcarmodelinfo mcm ON mcm.carinfoid=mc.id 
			LEFT JOIN insbinsuredhis mih ON mih.taskid=wm.instanceid AND mih.inscomcode=mq.inscomcode 
			LEFT JOIN insbperson mihp ON mihp.id=mih.personid 
			LEFT JOIN insbcarinfohis mch ON mch.taskid=wm.instanceid AND mch.inscomcode=mq.inscomcode 
			LEFT JOIN insbcarmodelinfohis mcmh ON mcmh.carinfoid=mc.id AND mcmh.inscomcode=mq.inscomcode 
			LEFT JOIN insccode mcc ON mcc.codetype='orderstatus' AND mcc.parentcode='orderstatus' AND mcc.codevalue=mo.orderstatus 
			LEFT JOIN insbpaychannel mpaych ON mpaych.id=mo.paymentmethod 
			LEFT JOIN inscdept mdept ON mdept.comcode=mq.deptcode 
			WHERE (wm.operator='' OR wm.operator IS NULL) AND wm.taskcode IN('23','24','27','28') 
				AND (mdept.parentcodes LIKE CONCAT('%', #{userorganization},'%') OR mdept.comcode=#{userorganization}) 
				AND EXISTS(select * FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
				WHERE qxgm.userid=#{loginUserId} AND ((wm.taskcode='27' AND qxmg.tasktype LIKE CONCAT('%',"b",'%')) 
					OR (wm.taskcode='28' AND qxmg.tasktype LIKE CONCAT('%',"c",'%')) OR (wm.taskcode='23' OR wm.taskcode='24'))))
		
			UNION(
			select ws.taskcode AS taskcode, ws.maininstanceid AS mInstanceid, ws.instanceid AS sInstanceid, sq.inscomcode AS inscomcode,
				(select MAX(wst.createtime) FROM insbworkflowsubtrack wst WHERE wst.maininstanceid=ws.maininstanceid and wst.instanceid=ws.instanceid and wst.taskcode=ws.taskcode and wst.taskstate in ('Reserved', 'Ready')) AS taskcreatetime,
				'2' AS mainOrsub, 
				CASE WHEN sch.carlicenseno IS NULL THEN sc.carlicenseno ELSE sch.carlicenseno END AS carlicenseno,
				CASE WHEN sihp.`name` IS NULL THEN sip.`name` ELSE sihp.`name` END AS insuredName,
				sqt.agentname AS agentname, sqt.agentnum AS agentnum, sqt.team AS team, 
				spr.prvname AS inscomname, sd.shortname AS deptname, scc.codename AS orderstatus, 
				CASE WHEN sq.buybusitype='02' THEN '网销' WHEN sq.buybusitype='03' THEN '电销' ELSE '传统' END AS buychannel, 
				ROUND(sbp.premium, 2) AS busdischarge, sbp.proposalformno AS busproposalformno, sbp.policyno AS buspolicyno, 
				ROUND(ssp.premium, 2) AS strdischarge, ssp.proposalformno AS strproposalformno, ssp.policyno AS strpolicyno, sagt.jobnumtype AS jobnumtype, 
				sagt.phone AS phone, wpaych.paychannelname AS paychannelname 
			FROM insbworkflowsub ws 
			LEFT JOIN insbinsured si ON ws.maininstanceid=si.taskid 
			LEFT JOIN insbperson sip ON sip.id=si.personid 
			LEFT JOIN insbquotetotalinfo sqt ON sqt.taskid=ws.maininstanceid 
			LEFT JOIN insbagent sagt ON sqt.agentnum=sagt.jobnum 
			LEFT JOIN insbworkflowmain swm ON swm.instanceid=ws.maininstanceid 
			LEFT JOIN insbquoteinfo sq ON sq.workflowinstanceid=ws.instanceid AND sq.quotetotalinfoid=sqt.id 
			LEFT JOIN insbpolicyitem sbp ON sbp.taskid=ws.maininstanceid AND sbp.inscomcode=sq.inscomcode AND sbp.risktype='0' 
			LEFT JOIN insbpolicyitem ssp ON ssp.taskid=ws.maininstanceid AND ssp.inscomcode=sq.inscomcode AND ssp.risktype='1' 
			LEFT JOIN insborder so ON so.taskid=ws.maininstanceid AND so.prvid=sq.inscomcode 
			LEFT JOIN inscdept sd ON sd.comcode=sq.deptcode 
			LEFT JOIN insbprovider spr ON spr.prvcode=sq.inscomcode 
			LEFT JOIN insbcarinfo sc ON sc.taskid=ws.maininstanceid 
			LEFT JOIN insbcarmodelinfo scm ON scm.carinfoid=sc.id 
			LEFT JOIN insbinsuredhis sih ON sih.taskid=ws.maininstanceid AND sih.inscomcode=sq.inscomcode 
			LEFT JOIN insbperson sihp ON sihp.id=sih.personid 
			LEFT JOIN insbcarinfohis sch ON sch.taskid=ws.maininstanceid AND sch.inscomcode=sq.inscomcode 
			LEFT JOIN insbcarmodelinfohis scmh ON scmh.carinfoid=sc.id AND scmh.inscomcode=sq.inscomcode 
			LEFT JOIN insccode scc ON scc.codetype='orderstatus' AND scc.parentcode='orderstatus' AND scc.codevalue=so.orderstatus 
			LEFT JOIN insbpaychannel wpaych ON wpaych.id=so.paymentmethod 
			LEFT JOIN inscdept sdept ON sdept.comcode=sq.deptcode 
			WHERE swm.taskcode IN('2','15') AND ws.taskcode='20' AND (ws.operator='' OR ws.operator IS NULL OR ws.operator='admin')
				AND EXISTS(select * FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
				WHERE qxgm.userid=#{loginUserId} AND qxmg.tasktype LIKE CONCAT('%',"9",'%'))
				AND (sdept.parentcodes LIKE CONCAT('%', #{userorganization},'%') OR sdept.comcode=#{userorganization}))) 
		
			UNION(
			select '999' AS taskcode, rc.id AS mInstanceid, rc.id AS sInstanceid, '' AS inscomcode, rc.createtime AS taskcreatetime,
				'3' AS mainOrsub, '' AS carlicenseno, '' AS insuredName, ra.`name` AS agentname, ra.jobnum AS agentnum, '' AS team,
				'' AS inscomname, rd.comname AS deptname, rc.`status` AS orderstatus, rcbus.codename AS buychannel, 
				'' AS busdischarge, rcc.comcodename AS busproposalformno, rcx.comcodename AS buspolicyno, 
				'' AS strdischarge, rcp.comcodename AS strproposalformno, '' AS strpolicyno, ra.jobnumtype AS jobnumtype, ra.phone AS phone, 
				'' AS paychannelname 
			FROM insbcertification rc 
			LEFT JOIN insccode rcbus ON rcbus.codetype='mainbusiness' AND rcbus.parentcode='mainbusiness' AND rcbus.codevalue=rc.mainbiz 
			LEFT JOIN insbagent ra ON ra.jobnum=rc.agentnum 
			LEFT JOIN inscdept rd ON rd.id=rc.deptid 
			LEFT JOIN insbregion rcp ON rcp.comcode=rd.province 
			LEFT JOIN insbregion rcc ON rcc.comcode=rd.city 
			LEFT JOIN insbregion rcx ON rcx.comcode=rd.county 
			WHERE rc.`status`=0 AND (rc.designatedoperator='' OR rc.designatedoperator IS NULL)
				AND EXISTS(select * FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
				WHERE qxgm.userid=#{loginUserId} AND qxmg.tasktype LIKE CONCAT('%',"h",'%'))
				AND (rd.parentcodes LIKE CONCAT('%', #{userorganization},'%') OR rd.comcode=#{userorganization}))) re
		<where>
			<if test="carlicensenoOrinsuredname != null">
			 	AND (re.carlicenseno LIKE CONCAT(#{carlicensenoOrinsuredname},'%')
			 	OR re.insuredName LIKE CONCAT(#{carlicensenoOrinsuredname},'%'))
			</if>
			<if test="taskstatus != null and taskstatus == '01'">
			 	AND re.taskcode = '20' 
			</if>
			<if test="taskstatus != null and taskstatus == '02'">
			 	AND re.taskcode IN ('23','27','28') 
			</if>
			<if test="taskstatus != null and taskstatus == '03'">
			 	AND re.taskcode = '24' 
			</if>
			<if test="taskstatus != null and taskstatus == '04'">
			 	AND re.taskcode = '999' 
			</if>
			<if test="insuredname != null">
			 	AND re.insuredName LIKE CONCAT(#{insuredname},'%')
			</if>
			<if test="agentName != null">
			 	AND re.agentname LIKE CONCAT(#{agentName},'%')
			</if>
			<if test="usertype != null">
			 	AND re.jobnumtype = #{usertype}
			</if>
			<if test="carlicenseno != null">
			 	AND re.carlicenseno=#{carlicenseno}
			</if>
			<if test="agentNum != null">
			 	AND re.agentnum = #{agentNum}
			</if>
			<if test="inscomcode != null">
			 	AND re.inscomcode = #{inscomcode}
			</if>
			<if test="agentphone != null">
			 	AND re.phone = #{agentphone}
			</if>
			<if test="maininstanceid != null">
			 	AND re.mInstanceid = #{maininstanceid}
			</if>
			<if test="taskcreatetimeup != null"> 
				AND re.taskcreatetime &gt;= DATE_FORMAT(#{taskcreatetimeup}, '%Y-%m-%d %H:%i:%S')
			</if>
			<if test="taskcreatetimedown != null">
			 	AND re.taskcreatetime &lt;= DATE_FORMAT(#{taskcreatetimedown}, '%Y-%m-%d %H:%i:%S')
			</if>
		</where>
	</select>
	<!-- 支付任务重新发起核保时判断核保途径 liuchao -->
	<select id="INSBOrder_getUnderwritingTrack" parameterType ="String" resultType="com.zzb.conf.entity.INSBWorkflowsubtrack">
		select * FROM insbworkflowsubtrack 
		WHERE taskcode IN ('16','17') AND instanceid=#{subInstanceId} ORDER BY createtime DESC;
	</select>
	<!-- 支付任务重新发起核保时判断核保途径 wang -->
	<select id="INSBOrder_getUnderwritingTrackStr" parameterType ="String" resultType="String">
		select DISTINCT taskcode FROM insbworkflowsubtrack 
		WHERE taskcode IN ('16','17','40','41') AND instanceid=#{subInstanceId} ORDER BY createtime DESC;
	</select>
	<!-- 判断报价途径 wang -->
	<select id="INSBOrder_getQuoteBackTrack" parameterType ="String" resultType="com.zzb.conf.entity.INSBWorkflowsubtrack">
		select * FROM insbworkflowsubtrack 
		WHERE taskcode IN ('3','4') AND instanceid=#{subInstanceId} ORDER BY createtime DESC;
	</select>
	
	<!-- 判断报价途径 wang 返回string-->
	<select id="INSBOrder_getQuoteBackTrackStr" parameterType ="String" resultType="String">
		select DISTINCT taskcode FROM insbworkflowsubtrack 
		WHERE taskcode IN ('3','4') AND instanceid=#{subInstanceId} ORDER BY createtime DESC;
	</select>
	
	<!-- 人工报价时报价成功后保费数据回写接口 liuchao -->
	<select id="INSBOrder_priceDataBackForManualRecording" parameterType ="Map">
		UPDATE insbquoteinfo qu 
		SET qu.quoteamount=(select SUM(re.amountprice) FROM 
				(select CASE WHEN amountprice IS NULL OR amountprice=0.0000 THEN discountCharge ELSE amountprice END AS amountprice FROM insbcarkindprice 
					WHERE taskid=#{maininstanceid} AND inscomcode=#{inscomcode}) re),
		qu.quotediscountamount=(select SUM(discountCharge) FROM insbcarkindprice WHERE taskid=#{maininstanceid} AND inscomcode=#{inscomcode}) ,
		qu.modifytime = NOW()
		WHERE qu.workflowinstanceid=#{subinstanceid}
	</select>
	
	<!-- 查询是否有领取支付任务的权限  杨威 2016-08-16-->
	<select id="INSBOrder_checkPayPower" parameterType="Map" resultType="Integer">
		select count(1) FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
		WHERE qxgm.userid=#{userId} AND (qxmg.tasktype LIKE CONCAT('%','9','%'))
	</select>
	<!-- 任务池 待支付查询 20160621 lining -->
	<select id="INSBOrder_selectOrderWorkflowsub" parameterType="Map" resultType="Map">
			/*slave*/select t.tasktype AS taskcode, t.maininstanceid AS mInstanceid, t.subinstanceid AS sInstanceid, t.inscomcode AS inscomcode,
		t.taskcreatetime AS taskcreatetime,
				'2' AS mainOrsub, 
				sch.carlicenseno AS carlicenseno,
				sihp.`name` AS insuredName,
				sqt.agentname AS agentname, sqt.agentnum AS agentnum, sqt.team AS team,
				(select l.channelname from insbchannel l
				where sqt.`purchaserchannel` = l.channelinnercode AND l.childflag='1' AND (l.deleteflag IS NULL OR l.deleteflag !='0'))  AS purchaserchannel,
				t.inscomname, t.deptname AS deptname,t.deptcode as comcode,
		(select mcc1.codevalue from
		  (select codename,codevalue from insccode mcc2  where mcc2.codetype = 'workflowNodelName'  AND mcc2.parentcode = 'workflowNodelName')mcc2
		   ,(select codename,codevalue from insccode mcc1 where  mcc1.codetype='tasktype' AND mcc1.parentcode='tasktype' )mcc1
		where mcc2.codevalue = ws.taskcode and mcc1.codename = mcc2.codename
		) as codevalue,
		  (select scc.codename from insccode scc where scc.codetype='orderstatus' AND scc.parentcode='orderstatus' AND scc.codevalue=so.orderstatus) AS orderstatus,
				CASE WHEN sq.buybusitype='02' THEN '网销' WHEN sq.buybusitype='03' THEN '电销' ELSE '传统' END AS buychannel, 
				ROUND(sbp.discountCharge, 2) AS busdischarge, sbp.proposalformno AS busproposalformno, sbp.policyno AS buspolicyno, 
				ROUND(ssp.discountCharge, 2) AS strdischarge, ssp.proposalformno AS strproposalformno, ssp.policyno AS strpolicyno,
				sagt.jobnumtype AS jobnumtype, sagt.phone AS phone,
			(select wpaych.paychannelname from insbpaychannel wpaych where wpaych.id=so.paymentmethod) AS paychannelname ,
			(select delivery.delivetype from insborderdelivery delivery where delivery.taskid=t.maininstanceid AND delivery.providerid=t.inscomcode) AS deliverytype
			from insbrealtimetask t
			LEFT JOIN insbworkflowsub ws ON  ws.maininstanceid = t.maininstanceid AND  t.subinstanceid = ws.instanceid
			/*LEFT JOIN insbinsured si ON ws.maininstanceid=si.taskid
			LEFT JOIN insbperson sip ON sip.id=si.personid*/
			LEFT JOIN insbquotetotalinfo sqt ON sqt.taskid=ws.maininstanceid 
			LEFT JOIN insbagent sagt ON sqt.agentnum=sagt.jobnum 
			LEFT JOIN insbworkflowmain swm ON swm.instanceid=ws.maininstanceid 
			LEFT JOIN insbquoteinfo sq ON sq.workflowinstanceid=ws.instanceid AND sq.quotetotalinfoid=sqt.id 
			LEFT JOIN insbpolicyitem sbp ON sbp.taskid=ws.maininstanceid AND sbp.inscomcode=t.inscomcode AND sbp.risktype='0'
			LEFT JOIN insbpolicyitem ssp ON ssp.taskid=ws.maininstanceid AND ssp.inscomcode=t.inscomcode AND ssp.risktype='1'
			LEFT JOIN insborder so ON so.taskid=ws.maininstanceid AND so.prvid=t.inscomcode
			/*INNER JOIN inscdept sd ON sd.comcode=sq.deptcode */
			/*INNER JOIN insbprovider spr ON spr.prvcode=sq.inscomcode */
			/*LEFT JOIN insbcarinfo sc ON sc.taskid=ws.maininstanceid*/
			LEFT JOIN insbinsuredhis sih ON sih.taskid=ws.maininstanceid AND sih.inscomcode=t.inscomcode
			LEFT JOIN insbperson sihp ON sihp.id=sih.personid 
			LEFT JOIN insbcarinfohis sch ON sch.taskid=ws.maininstanceid AND sch.inscomcode=t.inscomcode
			/*LEFT JOIN insbcarmodelinfohis scmh ON scmh.carinfoid=sc.id AND scmh.inscomcode=sq.inscomcode*/
			/*INNER JOIN insccode scc ON scc.codetype='orderstatus' AND scc.parentcode='orderstatus' AND scc.codevalue=so.orderstatus*/
			/*LEFT JOIN insccode mcc2 ON mcc2.codevalue = ws.taskcode AND mcc2.codetype = 'workflowNodelName' AND mcc2.parentcode = 'workflowNodelName'
			LEFT JOIN insccode mcc1 ON mcc1.codename = mcc2.codename AND mcc1.codetype='tasktype' AND mcc1.parentcode='tasktype'*/
			/*LEFT JOIN insbpaychannel wpaych ON wpaych.id=so.paymentmethod*/
			/*INNER JOIN inscdept sdept ON sdept.comcode=sq.deptcode
			LEFT JOIN insborderdelivery delivery ON delivery.taskid=ws.maininstanceid AND delivery.providerid=sq.inscomcode*/
		/*LEFT JOIN insbchannel l ON sqt.`purchaserchannel` = l.channelinnercode AND l.childflag='1' AND (l.deleteflag IS NULL OR l.deleteflag !='0')*/
		<where>
			swm.taskcode IN('2','15') AND t.tasktype='20' AND (ws.operator='' OR ws.operator IS NULL OR ws.operator='admin')
				AND t.deptinnercode LIKE CONCAT(#{userorganization},'%')
			<if test="carlicensenoOrinsuredname != null">
			 	AND (sch.carlicenseno=#{carlicensenoOrinsuredname}
			 	OR t.maininstanceid = #{carlicensenoOrinsuredname})
			</if>
			<if test="insuredname != null">
			 	AND sihp.`name` = #{insuredname}
			</if>
			<if test="agentName != null">
			 	AND sqt.agentname = #{agentName}
			</if>
			<if test="carlicenseno != null">
			 	AND sch.carlicenseno=#{carlicenseno}
			</if>
			<if test="agentNum != null">
			 	AND sagt.jobnum = #{agentNum}
			</if>
			<if test="inscomcode != null">
			 	AND t.inscomcode = #{inscomcode}
			</if>
			<if test="agentphone != null">
			 	AND sagt.phone = #{agentphone}
			</if>
			<if test="maininstanceid != null">
			 	AND t.maininstanceid = #{maininstanceid}
			</if>
			<if test="deptcode != null">
				AND t.deptcode=#{deptcode}
			</if>
			<if test="taskcreatetimeup != null"> 
				AND t.taskcreatetime &gt;= #{taskcreatetimeup}
			</if>
			<if test="taskcreatetimedown != null">
			 	AND t.taskcreatetime &lt;= #{taskcreatetimedown}
			</if>
			<if test="channelinnercode !=null and channelinnercode != ''">
				and sqt.`purchaserchannel`= #{channelinnercode}
			</if>
			<if test="paymentMethod !=null">
				AND so.paymentmethod = #{paymentMethod}
			</if>
		</where>
       ORDER BY t.taskcreatetime DESC
       LIMIT #{offset},#{limit}
	</select>
	
	<select id="INSBOrder_countOrderWorkflowsub" parameterType="Map" resultType="Long">
			/*slave*/select count(1)
		from insbrealtimetask t
		LEFT JOIN insbworkflowsub ws ON  ws.maininstanceid = t.maininstanceid AND  t.subinstanceid = ws.instanceid
		/*LEFT JOIN insbinsured si ON ws.maininstanceid=si.taskid
		LEFT JOIN insbperson sip ON sip.id=si.personid*/
		LEFT JOIN insbquotetotalinfo sqt ON sqt.taskid=ws.maininstanceid
		LEFT JOIN insbagent sagt ON sqt.agentnum=sagt.jobnum
		LEFT JOIN insbworkflowmain swm ON swm.instanceid=ws.maininstanceid
		/*LEFT JOIN insbquoteinfo sq ON sq.workflowinstanceid=ws.instanceid AND sq.quotetotalinfoid=sqt.id
		LEFT JOIN insbpolicyitem sbp ON sbp.taskid=ws.maininstanceid AND sbp.inscomcode=sq.inscomcode AND sbp.risktype='0'
		LEFT JOIN insbpolicyitem ssp ON ssp.taskid=ws.maininstanceid AND ssp.inscomcode=sq.inscomcode AND ssp.risktype='1'*/
		LEFT JOIN insborder so ON so.taskid=ws.maininstanceid AND so.prvid=t.inscomcode
		/*INNER JOIN inscdept sd ON sd.comcode=sq.deptcode */
		/*INNER JOIN insbprovider spr ON spr.prvcode=sq.inscomcode*/
		/*LEFT JOIN insbcarinfo sc ON sc.taskid=ws.maininstanceid*/
		LEFT JOIN insbinsuredhis sih ON sih.taskid=ws.maininstanceid AND sih.inscomcode=t.inscomcode
		LEFT JOIN insbperson sihp ON sihp.id=sih.personid
		LEFT JOIN insbcarinfohis sch ON sch.taskid=ws.maininstanceid AND sch.inscomcode=t.inscomcode
		/*LEFT JOIN insbcarmodelinfohis scmh ON scmh.carinfoid=sc.id AND scmh.inscomcode=sq.inscomcode
		INNER JOIN insccode scc ON scc.codetype='orderstatus' AND scc.parentcode='orderstatus' AND scc.codevalue=so.orderstatus
		LEFT JOIN insccode mcc2 ON mcc2.codevalue = ws.taskcode AND mcc2.codetype = 'workflowNodelName' AND mcc2.parentcode = 'workflowNodelName'
		LEFT JOIN insccode mcc1 ON mcc1.codename = mcc2.codename AND mcc1.codetype='tasktype' AND mcc1.parentcode='tasktype'
		LEFT JOIN insbpaychannel wpaych ON wpaych.id=so.paymentmethod
		INNER JOIN inscdept sdept ON sdept.comcode=sq.deptcode
		LEFT JOIN insborderdelivery delivery ON delivery.taskid=ws.maininstanceid AND delivery.providerid=sq.inscomcode*/
		/*LEFT JOIN insbchannel l ON sqt.`purchaserchannel` = l.channelinnercode AND l.childflag='1' AND (l.deleteflag IS NULL OR l.deleteflag !='0')*/
		<where>
			swm.taskcode IN('2','15') AND t.tasktype='20' AND (ws.operator='' OR ws.operator IS NULL OR ws.operator='admin')
			AND t.deptinnercode LIKE CONCAT(#{userorganization},'%')
			<if test="carlicensenoOrinsuredname != null">
				AND (sch.carlicenseno=#{carlicensenoOrinsuredname}
				OR t.maininstanceid = #{carlicensenoOrinsuredname})
			</if>
			<if test="insuredname != null">
				AND sihp.`name` = #{insuredname}
			</if>
			<if test="agentName != null">
				AND sqt.agentname = #{agentName}
			</if>
			<if test="carlicenseno != null">
				AND sch.carlicenseno=#{carlicenseno}
			</if>
			<if test="agentNum != null">
				AND sagt.jobnum = #{agentNum}
			</if>
			<if test="inscomcode != null">
				AND t.inscomcode = #{inscomcode}
			</if>
			<if test="agentphone != null">
				AND sagt.phone = #{agentphone}
			</if>
			<if test="maininstanceid != null">
				AND t.maininstanceid = #{maininstanceid}
			</if>
			<if test="deptcode != null">
				AND t.deptcode=#{deptcode}
			</if>
			<if test="taskcreatetimeup != null">
				AND t.taskcreatetime &gt;= #{taskcreatetimeup}
			</if>
			<if test="taskcreatetimedown != null">
				AND t.taskcreatetime &lt;= #{taskcreatetimedown}
			</if>
			<if test="channelinnercode !=null and channelinnercode != ''">
				and sqt.`purchaserchannel`= #{channelinnercode}
			</if>
			<if test="paymentMethod !=null">
				AND so.paymentmethod = #{paymentMethod}
			</if>
		</where>
	</select>
	
	<!-- 任务池 待承保打单/待配送查询 20160621 lining -->
	<select id="INSBOrder_selectOrderWorkflowmain" parameterType="Map" resultType="Map">
		/*slave*/select wm.taskcode AS taskcode, wm.instanceid AS mInstanceid, mws.instanceid AS sInstanceid, mq.inscomcode AS inscomcode,mo.orderstatus AS orde,
			(select MAX(wmt.createtime) FROM insbworkflowmaintrack wmt WHERE wmt.instanceid=wm.instanceid and wmt.taskcode=wm.taskcode and wmt.taskstate in ('Reserved', 'Ready')) AS taskcreatetime,
			'1' AS mainOrsub, mch.carlicenseno AS carlicenseno, mihp.`name` AS insuredName,
			mqt.agentname AS agentname, mqt.agentnum AS agentnum, mqt.team AS team,
		    l.channelname AS purchaserchannel,
			mpr.prvname AS inscomname, md.shortname AS deptname,t.deptcode as comcode,mcc1.codevalue, mcc.codename AS orderstatus,
			CASE WHEN mq.buybusitype='02' THEN '网销' WHEN mq.buybusitype='03' THEN '电销' ELSE '传统' END AS buychannel, 
			ROUND(mbp.discountCharge, 2) AS busdischarge, mbp.proposalformno AS busproposalformno, mbp.policyno AS buspolicyno, 
			ROUND(msp.discountCharge, 2) AS strdischarge, msp.proposalformno AS strproposalformno, msp.policyno AS strpolicyno, magt.jobnumtype AS jobnumtype, 
			magt.phone AS phone, mpaych.paychannelname AS paychannelname, delivery.delivetype AS deliverytype
		FROM insbworkflowmain wm 
		LEFT JOIN insbinsured mi ON wm.instanceid=mi.taskid 
		LEFT JOIN insbperson mip ON mip.id=mi.personid 
		LEFT JOIN insbquotetotalinfo mqt ON mqt.taskid=wm.instanceid 
		LEFT JOIN insbagent magt ON mqt.agentnum=magt.jobnum 
		LEFT JOIN insbworkflowsub mws ON mws.maininstanceid=wm.instanceid AND mws.taskstate!='Closed' 
		LEFT JOIN insbquoteinfo mq ON mq.workflowinstanceid=mws.instanceid AND mq.quotetotalinfoid=mqt.id 
		LEFT JOIN insbpolicyitem mbp ON mbp.taskid=wm.instanceid AND mbp.inscomcode=mq.inscomcode AND mbp.risktype='0' 
		LEFT JOIN insbpolicyitem msp ON msp.taskid=wm.instanceid AND msp.inscomcode=mq.inscomcode AND msp.risktype='1' 
		LEFT JOIN insborder mo ON mo.taskid=wm.instanceid AND mo.prvid=mq.inscomcode 
		INNER JOIN inscdept md ON md.comcode=mq.deptcode 
		INNER JOIN insbprovider mpr ON mpr.prvcode=mq.inscomcode 
		LEFT JOIN insbcarinfo mc ON mc.taskid=wm.instanceid 
		LEFT JOIN insbinsuredhis mih ON mih.taskid=wm.instanceid AND mih.inscomcode=mq.inscomcode 
		LEFT JOIN insbperson mihp ON mihp.id=mih.personid 
		LEFT JOIN insbcarinfohis mch ON mch.taskid=wm.instanceid AND mch.inscomcode=mq.inscomcode 
		LEFT JOIN insbcarmodelinfohis mcmh ON mcmh.carinfoid=mc.id AND mcmh.inscomcode=mq.inscomcode 
		INNER JOIN insccode mcc ON mcc.codetype='orderstatus' AND mcc.parentcode='orderstatus' AND mcc.codevalue=mo.orderstatus
		LEFT JOIN insccode mcc2 ON mcc2.codevalue = wm.taskcode AND mcc2.codetype = 'workflowNodelName' AND mcc2.parentcode = 'workflowNodelName'
		LEFT JOIN insccode mcc1 ON mcc1.codename = mcc2.codename AND mcc1.codetype='tasktype' AND mcc1.parentcode='tasktype' 
		LEFT JOIN insbpaychannel mpaych ON mpaych.id=mo.paymentmethod 
		INNER JOIN inscdept mdept ON mdept.comcode=mq.deptcode 
		LEFT JOIN insborderdelivery delivery ON delivery.taskid=wm.instanceid
		LEFT JOIN insbchannel l ON mqt.`purchaserchannel` = l.channelinnercode AND l.childflag='1' AND (l.deleteflag IS NULL OR l.deleteflag !='0')
		<where>
			(wm.operator='' OR wm.operator IS NULL) AND wm.taskcode IN('23','24','27','28') 
			AND mdept.deptinnercode LIKE CONCAT(#{userorganization},'%')
			<!-- (mdept.parentcodes LIKE CONCAT('%', #{userorganization},'%') OR mdept.comcode=#{userorganization})  -->
			AND EXISTS(select * FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
			WHERE qxgm.userid=#{loginUserId} AND ((wm.taskcode='27' AND qxmg.tasktype LIKE CONCAT('%',"b",'%')) 
				OR (wm.taskcode='28' AND qxmg.tasktype LIKE CONCAT('%',"c",'%')) OR (wm.taskcode='23' OR wm.taskcode='24')))
			<if test="carlicensenoOrinsuredname != null">
			 	AND (mch.carlicenseno LIKE CONCAT(#{carlicensenoOrinsuredname},'%')
			 	OR mihp.`name` LIKE CONCAT(#{carlicensenoOrinsuredname},'%'))
			</if>
			<if test="taskstatus != null and taskstatus == '02'">
			 	AND wm.taskcode IN ('23','27','28') 
			</if>
			<if test="taskstatus != null and taskstatus == '03'">
			 	AND wm.taskcode = '24' 
			</if>
			<if test="insuredname != null">
			 	AND mihp.`name` LIKE CONCAT(#{insuredname},'%')
			</if>
			<if test="agentName != null">
			 	AND mqt.agentname LIKE CONCAT(#{agentName},'%')
			</if>
			<if test="usertype != null">
			 	AND magt.jobnumtype = #{usertype}
			</if>
			<if test="carlicenseno != null">
			 	AND mch.carlicenseno=#{carlicenseno}
			</if>
			<if test="agentNum != null">
			 	AND mqt.agentnum = #{agentNum}
			</if>
			<if test="inscomcode != null">
			 	AND mq.inscomcode = #{inscomcode}
			</if>
			<if test="agentphone != null">
			 	AND magt.phone = #{agentphone}
			</if>
			<if test="maininstanceid != null">
			 	AND wm.instanceid = #{maininstanceid}
			</if>
			<if test="deptcode != null">
				AND md.comcode = #{deptcode}
			</if>
			<if test="taskcreatetimeup != null"> 
				AND (select MAX(wmt.createtime) FROM insbworkflowmaintrack wmt WHERE wmt.instanceid=wm.instanceid and wmt.taskcode=wm.taskcode and wmt.taskstate in ('Reserved', 'Ready')) &gt;= #{taskcreatetimeup}
			</if>
			<if test="taskcreatetimedown != null">
			 	AND (select MAX(wmt.createtime) FROM insbworkflowmaintrack wmt WHERE wmt.instanceid=wm.instanceid and wmt.taskcode=wm.taskcode and wmt.taskstate in ('Reserved', 'Ready')) &lt;= #{taskcreatetimedown}
			</if>
            <if test="deliveryType != null and deliveryType != ''">
                AND delivery.delivetype = #{deliveryType}
            </if>
			<if test="channelinnercode !=null and channelinnercode != ''">
				and mqt.`purchaserchannel`= #{channelinnercode}
			</if>
		</where>
       ORDER BY (select MAX(wmt.createtime) FROM insbworkflowmaintrack wmt WHERE wmt.instanceid=wm.instanceid and wmt.taskcode=wm.taskcode and wmt.taskstate in ('Reserved', 'Ready')) DESC 
       LIMIT #{offset},#{limit}
	</select>

	<select id="INSBOrder_selectOrderWorkflowmain2" parameterType="Map" resultType="Map">
		/*slave*/select t.tasktype as taskcode, t.maininstanceid as mInstanceid, mq.workflowinstanceid as sInstanceid, t.inscomcode,mo.orderstatus AS orde,
		t.taskcreatetime,'1' AS mainOrsub,mch.carlicenseno AS carlicenseno,mihp.`name` AS insuredName,
		mqt.agentname AS agentname, mqt.agentnum AS agentnum, mqt.team AS team,
		(select l.channelname from insbchannel l
		where mqt.`purchaserchannel` = l.channelinnercode AND l.childflag='1' AND (l.deleteflag IS NULL OR l.deleteflag !='0'))  AS purchaserchannel,
		t.inscomname,t.deptname AS deptname,t.deptcode as comcode,
		(select mcc1.codevalue from
		(select codename,codevalue from insccode mcc2  where mcc2.codetype = 'workflowNodelName'  AND mcc2.parentcode = 'workflowNodelName')mcc2
		, (select codename,codevalue from insccode mcc1 where  mcc1.codetype='tasktype' AND mcc1.parentcode='tasktype' )mcc1
		where mcc2.codevalue = wm.taskcode and mcc1.codename = mcc2.codename
		) as codevalue,
		(select scc.codename from insccode scc where scc.codetype='orderstatus' AND scc.parentcode='orderstatus' AND scc.codevalue=mo.orderstatus) AS orderstatus,
		CASE WHEN mq.buybusitype='02' THEN '网销' WHEN mq.buybusitype='03' THEN '电销' ELSE '传统' END AS buychannel,
		ROUND(mbp.discountCharge, 2) AS busdischarge, mbp.proposalformno AS busproposalformno, mbp.policyno AS buspolicyno,
		ROUND(msp.discountCharge, 2) AS strdischarge, msp.proposalformno AS strproposalformno, msp.policyno AS strpolicyno,
		magt.jobnumtype AS jobnumtype, magt.phone AS phone,
		(select wpaych.paychannelname from insbpaychannel wpaych where wpaych.id=mo.paymentmethod) AS paychannelname ,
		delivery.delivetype AS deliverytype

		from insbrealtimetask t
		/*LEFT JOIN insbworkflowsub ws ON  ws.maininstanceid = t.maininstanceid AND  t.subinstanceid = ws.instanceid AND ws.taskstate!='Closed'*/
		LEFT JOIN insbworkflowmain wm ON wm.instanceid = t.maininstanceid
		LEFT JOIN insbquotetotalinfo mqt ON mqt.taskid=wm.instanceid
		LEFT JOIN insborder mo ON mo.taskid=t.maininstanceid AND mo.prvid=t.inscomcode
		LEFT JOIN insbcarinfohis mch ON mch.taskid=t.maininstanceid AND mch.inscomcode=t.inscomcode
		LEFT JOIN insbinsuredhis mih ON mih.taskid=t.maininstanceid AND mih.inscomcode=t.inscomcode
		LEFT JOIN insbperson mihp ON mihp.id=mih.personid
		LEFT JOIN insbagent magt ON mqt.agentnum=magt.jobnum
		/*INNER JOIN insbprovider mpr ON mpr.prvcode=t.inscomcode*/
		/*INNER JOIN inscdept md ON md.comcode=t.deptcode*/
		/*INNER JOIN insccode mcc ON mcc.codetype='orderstatus' AND mcc.parentcode='orderstatus' AND mcc.codevalue=mo.orderstatus*/
		/*LEFT JOIN insccode mcc2 ON mcc2.codevalue = wm.taskcode AND mcc2.codetype = 'workflowNodelName' AND mcc2.parentcode = 'workflowNodelName'
		LEFT JOIN insccode mcc1 ON mcc1.codename = mcc2.codename AND mcc1.codetype='tasktype' AND mcc1.parentcode='tasktype'*/
		/*LEFT JOIN insbworkflowsub mws ON mws.maininstanceid=wm.instanceid AND mws.taskstate!='Closed'*/
		LEFT JOIN insbquoteinfo mq ON mq.inscomcode=t.inscomcode AND mq.quotetotalinfoid=mqt.id
		LEFT JOIN insbpolicyitem mbp ON mbp.taskid=wm.instanceid AND mbp.inscomcode=mq.inscomcode AND mbp.risktype='0'
		LEFT JOIN insbpolicyitem msp ON msp.taskid=wm.instanceid AND msp.inscomcode=mq.inscomcode AND msp.risktype='1'
		LEFT JOIN insborderdelivery delivery ON delivery.taskid=wm.instanceid
		/*LEFT JOIN insbpaychannel mpaych ON mpaych.id=mo.paymentmethod*/
		/*INNER JOIN inscdept mdept ON mdept.comcode=mq.deptcode*/
		/*LEFT JOIN insbchannel l ON mqt.`purchaserchannel` = l.channelinnercode AND l.childflag='1' AND (l.deleteflag IS NULL OR l.deleteflag !='0')*/
		<where>
			(wm.operator='' OR wm.operator IS NULL) AND t.tasktype IN('23','24','27','28') AND mo.orderstatus <![CDATA[ <> ]]> '5' 
			AND t.deptinnercode LIKE CONCAT(#{userorganization},'%')
			<if test="carlicensenoOrinsuredname != null">
				AND (mch.carlicenseno = #{carlicensenoOrinsuredname}
				OR mihp.`name` = #{carlicensenoOrinsuredname})
			</if>
			<if test="taskstatus != null and taskstatus == '02'">
				AND t.tasktype IN ('23','27','28')
			</if>
			<if test="taskstatus != null and taskstatus == '03'">
				AND t.tasktype = '24'
			</if>
			<if test="insuredname != null">
				AND mihp.`name` =#{insuredname}
			</if>
			<if test="agentName != null">
				AND mqt.agentname =#{agentName}
			</if>
			<if test="usertype != null">
				AND magt.jobnumtype = #{usertype}
			</if>
			<if test="carlicenseno != null">
				AND mch.carlicenseno=#{carlicenseno}
			</if>
			<if test="agentNum != null">
				AND mqt.agentnum = #{agentNum}
			</if>
			<if test="inscomcode != null">
				AND t.inscomcode = #{inscomcode}
			</if>
			<if test="agentphone != null">
				AND magt.phone = #{agentphone}
			</if>
			<if test="maininstanceid != null">
				AND t.maininstanceid = #{maininstanceid}
			</if>
			<if test="deptcode != null">
				AND t.deptcode = #{deptcode}
			</if>
			<if test="taskcreatetimeup != null">
				AND t.taskcreatetime &gt;= #{taskcreatetimeup}
			</if>
			<if test="taskcreatetimedown != null">
				AND t.taskcreatetime &lt;= #{taskcreatetimedown}
			</if>
			<if test="deliveryType != null and deliveryType != ''">
				AND delivery.delivetype = #{deliveryType}
			</if>
			<if test="channelinnercode !=null and channelinnercode != ''">
				and mqt.`purchaserchannel`= #{channelinnercode}
			</if>
		</where>
		ORDER BY t.taskcreatetime DESC
		LIMIT #{offset},#{limit}
	</select>

	<select id="INSBOrder_countOrderWorkflowmain" parameterType="Map" resultType="Long">
		/*slave*/select count(1)
		FROM insbworkflowmain wm 
		LEFT JOIN insbinsured mi ON wm.instanceid=mi.taskid 
		LEFT JOIN insbperson mip ON mip.id=mi.personid 
		LEFT JOIN insbquotetotalinfo mqt ON mqt.taskid=wm.instanceid 
		LEFT JOIN insbagent magt ON mqt.agentnum=magt.jobnum 
		LEFT JOIN insbworkflowsub mws ON mws.maininstanceid=wm.instanceid AND mws.taskstate!='Closed' 
		LEFT JOIN insbquoteinfo mq ON mq.workflowinstanceid=mws.instanceid AND mq.quotetotalinfoid=mqt.id 
		LEFT JOIN insbpolicyitem mbp ON mbp.taskid=wm.instanceid AND mbp.inscomcode=mq.inscomcode AND mbp.risktype='0' 
		LEFT JOIN insbpolicyitem msp ON msp.taskid=wm.instanceid AND msp.inscomcode=mq.inscomcode AND msp.risktype='1' 
		LEFT JOIN insborder mo ON mo.taskid=wm.instanceid AND mo.prvid=mq.inscomcode 
		INNER JOIN inscdept md ON md.comcode=mq.deptcode 
		INNER JOIN insbprovider mpr ON mpr.prvcode=mq.inscomcode 
		LEFT JOIN insbcarinfo mc ON mc.taskid=wm.instanceid 
		LEFT JOIN insbinsuredhis mih ON mih.taskid=wm.instanceid AND mih.inscomcode=mq.inscomcode 
		LEFT JOIN insbperson mihp ON mihp.id=mih.personid 
		LEFT JOIN insbcarinfohis mch ON mch.taskid=wm.instanceid AND mch.inscomcode=mq.inscomcode 
		LEFT JOIN insbcarmodelinfohis mcmh ON mcmh.carinfoid=mc.id AND mcmh.inscomcode=mq.inscomcode 
		INNER JOIN insccode mcc ON mcc.codetype='orderstatus' AND mcc.parentcode='orderstatus' AND mcc.codevalue=mo.orderstatus
		LEFT JOIN insbpaychannel mpaych ON mpaych.id=mo.paymentmethod 
		INNER JOIN inscdept mdept ON mdept.comcode=mq.deptcode
        LEFT JOIN insborderdelivery delivery ON delivery.taskid=wm.instanceid
		LEFT JOIN insbchannel l ON mqt.`purchaserchannel` = l.channelinnercode AND l.childflag='1' AND (l.deleteflag IS NULL OR l.deleteflag !='0')
		<where>
			(wm.operator='' OR wm.operator IS NULL) AND wm.taskcode IN('23','24','27','28')
			AND mdept.deptinnercode LIKE CONCAT(#{userorganization},'%')
			AND EXISTS(select * FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
			WHERE qxgm.userid=#{loginUserId} AND ((wm.taskcode='27' AND qxmg.tasktype LIKE CONCAT('%',"b",'%')) 
				OR (wm.taskcode='28' AND qxmg.tasktype LIKE CONCAT('%',"c",'%')) OR (wm.taskcode='23' OR wm.taskcode='24')))
			<if test="carlicensenoOrinsuredname != null">
			 	AND (mch.carlicenseno LIKE CONCAT(#{carlicensenoOrinsuredname},'%')
			 	OR mihp.`name` LIKE CONCAT(#{carlicensenoOrinsuredname},'%'))
			</if>
			<if test="taskstatus != null and taskstatus == '02'">
			 	AND wm.taskcode IN ('23','27','28')
			</if>
			<if test="taskstatus != null and taskstatus == '03'">
			 	AND wm.taskcode = '24'
			</if>
			<if test="insuredname != null">
			 	AND mihp.`name` LIKE CONCAT(#{insuredname},'%')
			</if>
			<if test="agentName != null">
			 	AND mqt.agentname LIKE CONCAT(#{agentName},'%')
			</if>
			<if test="usertype != null">
			 	AND magt.jobnumtype = #{usertype}
			</if>
			<if test="carlicenseno != null">
			 	AND mch.carlicenseno=#{carlicenseno}
			</if>
			<if test="agentNum != null">
			 	AND mqt.agentnum = #{agentNum}
			</if>
			<if test="inscomcode != null">
			 	AND mq.inscomcode = #{inscomcode}
			</if>
			<if test="agentphone != null">
			 	AND magt.phone = #{agentphone}
			</if>
			<if test="maininstanceid != null">
			 	AND wm.instanceid = #{maininstanceid}
			</if>
			<if test="deptcode != null">
				AND md.comcode = #{deptcode}
			</if>
			<if test="taskcreatetimeup != null"> 
				AND (select MAX(wmt.createtime) FROM insbworkflowmaintrack wmt WHERE wmt.instanceid=wm.instanceid and wmt.taskcode=wm.taskcode and wmt.taskstate in ('Reserved', 'Ready')) &gt;= #{taskcreatetimeup}
			</if>
			<if test="taskcreatetimedown != null">
			 	AND (select MAX(wmt.createtime) FROM insbworkflowmaintrack wmt WHERE wmt.instanceid=wm.instanceid and wmt.taskcode=wm.taskcode and wmt.taskstate in ('Reserved', 'Ready')) &lt;= #{taskcreatetimedown}
			</if>
            <if test="deliveryType != null and deliveryType != ''">
                AND delivery.delivetype = #{deliveryType}
            </if>
			<if test="channelinnercode !=null and channelinnercode != ''">
				and mqt.`purchaserchannel`= #{channelinnercode}
			</if>
		</where>
	</select>
	<select id="INSBOrder_countOrderWorkflowmain2" parameterType="Map" resultType="Long">
		/*slave*/select count(1)
		from insbrealtimetask t
		/*LEFT JOIN insbworkflowsub ws ON  ws.maininstanceid = t.maininstanceid AND  t.subinstanceid = ws.instanceid AND ws.taskstate!='Closed'*/
		LEFT JOIN insbworkflowmain wm ON wm.instanceid = t.maininstanceid
		LEFT JOIN insbquotetotalinfo mqt ON mqt.taskid=wm.instanceid
		/*LEFT JOIN insborder mo ON mo.taskid=t.maininstanceid AND mo.prvid=t.inscomcode*/
		LEFT JOIN insbcarinfohis mch ON mch.taskid=t.maininstanceid AND mch.inscomcode=t.inscomcode
		LEFT JOIN insbinsuredhis mih ON mih.taskid=t.maininstanceid AND mih.inscomcode=t.inscomcode
		LEFT JOIN insbperson mihp ON mihp.id=mih.personid
		LEFT JOIN insbagent magt ON mqt.agentnum=magt.jobnum
		/*INNER JOIN insbprovider mpr ON mpr.prvcode=t.inscomcode*/
		/*INNER JOIN inscdept md ON md.comcode=t.deptcode*/
		/*INNER JOIN insccode mcc ON mcc.codetype='orderstatus' AND mcc.parentcode='orderstatus' AND mcc.codevalue=mo.orderstatus
		LEFT JOIN insccode mcc2 ON mcc2.codevalue = wm.taskcode AND mcc2.codetype = 'workflowNodelName' AND mcc2.parentcode = 'workflowNodelName'
		LEFT JOIN insccode mcc1 ON mcc1.codename = mcc2.codename AND mcc1.codetype='tasktype' AND mcc1.parentcode='tasktype'*/
		/*LEFT JOIN insbworkflowsub mws ON mws.maininstanceid=wm.instanceid AND mws.taskstate!='Closed'*/
		/*LEFT JOIN insbquoteinfo mq ON mq.inscomcode=t.inscomcode AND mq.quotetotalinfoid=mqt.id
		LEFT JOIN insbpolicyitem mbp ON mbp.taskid=wm.instanceid AND mbp.inscomcode=mq.inscomcode AND mbp.risktype='0'
		LEFT JOIN insbpolicyitem msp ON msp.taskid=wm.instanceid AND msp.inscomcode=mq.inscomcode AND msp.risktype='1'*/
		LEFT JOIN insborderdelivery delivery ON delivery.taskid=wm.instanceid
		/*LEFT JOIN insbpaychannel mpaych ON mpaych.id=mo.paymentmethod
		INNER JOIN inscdept mdept ON mdept.comcode=mq.deptcode*/
		/*LEFT JOIN insbchannel l ON mqt.`purchaserchannel` = l.channelinnercode AND l.childflag='1' AND (l.deleteflag IS NULL OR l.deleteflag !='0')*/
		<where>
			(wm.operator='' OR wm.operator IS NULL) AND t.tasktype IN('23','24','27','28')
			AND t.deptinnercode LIKE CONCAT(#{userorganization},'%')
			<if test="carlicensenoOrinsuredname != null">
				AND (mch.carlicenseno LIKE CONCAT(#{carlicensenoOrinsuredname},'%')
				OR t.maininstanceid = #{carlicensenoOrinsuredname})
			</if>
			<if test="taskstatus != null and taskstatus == '02'">
				AND t.tasktype IN ('23','27','28')
			</if>
			<if test="taskstatus != null and taskstatus == '03'">
				AND t.tasktype = '24'
			</if>
			<if test="insuredname != null">
				AND mihp.`name` =#{insuredname}
			</if>
			<if test="agentName != null">
				AND mqt.agentname =#{agentName}
			</if>
			<if test="usertype != null">
				AND magt.jobnumtype = #{usertype}
			</if>
			<if test="carlicenseno != null">
				AND mch.carlicenseno=#{carlicenseno}
			</if>
			<if test="agentNum != null">
				AND mqt.agentnum = #{agentNum}
			</if>
			<if test="inscomcode != null">
				AND t.inscomcode = #{inscomcode}
			</if>
			<if test="agentphone != null">
				AND magt.phone = #{agentphone}
			</if>
			<if test="maininstanceid != null">
				AND t.maininstanceid = #{maininstanceid}
			</if>
			<if test="deptcode != null">
				AND t.deptcode = #{deptcode}
			</if>
			<if test="taskcreatetimeup != null">
				AND t.taskcreatetime &gt;= #{taskcreatetimeup}
			</if>
			<if test="taskcreatetimedown != null">
				AND t.taskcreatetime &lt;= #{taskcreatetimedown}
			</if>
			<if test="deliveryType != null and deliveryType != ''">
				AND delivery.delivetype = #{deliveryType}
			</if>
			<if test="channelinnercode !=null and channelinnercode != ''">
				and mqt.`purchaserchannel`= #{channelinnercode}
			</if>
		</where>
	</select>
	<!-- 任务池认证任务查询 	杨威	2016/2/22 -->
	
	<select id="INSBOrder_selectCertification" parameterType="Map" resultType="Map">
		/*slave*/select '999' AS taskcode, rc.id AS mInstanceid, rc.id AS sInstanceid, '' AS inscomcode, rc.createtime AS taskcreatetime,
			'3' AS mainOrsub, '' AS carlicenseno, '' AS insuredName, ra.`name` AS agentname, ra.jobnum AS agentnum, '' AS team, '' AS purchaserchannel,
			'' AS inscomname, rd.comname AS deptname, rc.`status` AS orderstatus, rcbus.codename AS buychannel, rc.deptid,
			'' AS busdischarge, rcc.comcodename AS busproposalformno, rcx.comcodename AS buspolicyno, 
			'' AS strdischarge, rcp.comcodename AS strproposalformno, '' AS strpolicyno, ra.jobnumtype AS jobnumtype, ra.phone AS phone, 
			'' AS paychannelname 
		FROM insbcertification rc 
		LEFT JOIN insccode rcbus ON rcbus.codetype='mainbusiness' AND rcbus.parentcode='mainbusiness' AND rcbus.codevalue=rc.mainbiz 
		LEFT JOIN insbagent ra ON ra.tempjobnum=rc.agentnum 
		LEFT JOIN inscdept rd ON rd.id=rc.deptid 
		LEFT JOIN insbregion rcp ON rcp.comcode=rd.province 
		LEFT JOIN insbregion rcc ON rcc.comcode=rd.city 
		LEFT JOIN insbregion rcx ON rcx.comcode=rd.county 
		<where>
			rc.`status`=0 AND (rc.designatedoperator='' OR rc.designatedoperator IS NULL)
			AND EXISTS(select * FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
			WHERE qxgm.userid=#{loginUserId} AND qxmg.tasktype LIKE CONCAT('%',"h",'%'))
			AND rd.deptinnercode LIKE CONCAT(#{userorganization},'%')
			<if test="agentName != null">
			 	AND ra.`name` LIKE CONCAT(#{agentName},'%')
			</if>
			<if test="usertype != null">
			 	AND ra.jobnumtype = #{usertype}
			</if>
			<if test="agentNum != null">
			 	AND ra.jobnum = #{agentNum}
			</if>
			<if test="agentphone != null">
			 	AND ra.phone = #{agentphone}
			</if>
			<if test="maininstanceid != null">
			 	AND rc.id = #{maininstanceid}
			</if>
			<if test="taskcreatetimeup != null"> 
				AND rc.createtime &gt;= #{taskcreatetimeup}
			</if>
			<if test="taskcreatetimedown != null">
			 	AND rc.createtime &lt;= #{taskcreatetimedown}
			</if>
		</where>
       ORDER BY rc.createtime DESC 
       LIMIT #{offset},#{limit}
	</select>
	
	<!-- 查询任务池认证任务总条数  杨威  -->
	<select id="INSBOrder_countCertification" parameterType="Map" resultType="Long">
		/*slave*/select count(1)
		FROM insbcertification rc 
		LEFT JOIN insccode rcbus ON rcbus.codetype='mainbusiness' AND rcbus.parentcode='mainbusiness' AND rcbus.codevalue=rc.mainbiz 
		LEFT JOIN insbagent ra ON ra.tempjobnum=rc.agentnum 
		LEFT JOIN inscdept rd ON rd.id=rc.deptid 
		LEFT JOIN insbregion rcp ON rcp.comcode=rd.province 
		LEFT JOIN insbregion rcc ON rcc.comcode=rd.city 
		LEFT JOIN insbregion rcx ON rcx.comcode=rd.county 
		<where>
			rc.`status`=0 AND (rc.designatedoperator='' OR rc.designatedoperator IS NULL)
			AND EXISTS(select * FROM insbgroupmembers qxgm LEFT JOIN insbbusinessmanagegroup qxmg ON qxgm.groupid=qxmg.id 
			WHERE qxgm.userid=#{loginUserId} AND qxmg.tasktype LIKE CONCAT('%',"h",'%'))
			AND rd.deptinnercode LIKE CONCAT(#{userorganization},'%')
			<if test="agentName != null">
			 	AND ra.`name` LIKE CONCAT(#{agentName},'%')
			</if>
			<if test="usertype != null">
			 	AND ra.jobnumtype = #{usertype}
			</if>
			<if test="agentNum != null">
			 	AND ra.jobnum = #{agentNum}
			</if>
			<if test="agentphone != null">
			 	AND ra.phone = #{agentphone}
			</if>
			<if test="maininstanceid != null">
			 	AND rc.id = #{maininstanceid}
			</if>
			<if test="taskcreatetimeup != null"> 
				AND rc.createtime &gt;= #{taskcreatetimeup}
			</if>
			<if test="taskcreatetimedown != null">
			 	AND rc.createtime &lt;= #{taskcreatetimedown}
			</if>
		</where>
	</select>

	<select id="INSBOrder_selectOrdersWithFairyQRPay" parameterType="map" resultType="com.zzb.cm.entity.INSBOrder">
		select a.* from insborder a INNER JOIN insborderpayment b on b.orderid = a.id
		<where>
			a.paymentstatus<![CDATA[ <> ]]>'02' and  a.paymentmethod='51' and  b.paychannelid='51' 
			<if test="fromDateTime!=null and toDateTime!=null">
				and b.createtime between #{fromDateTime} and #{toDateTime}
			</if>
		</where>
		GROUP BY a.taskid
		order by b.createtime desc
		limit #{offset}, #{limit}
	</select>

	<select id="INSBOrder_selectOrdersCountWithFairyQRPay" parameterType="map" resultType="long">
		select count(DISTINCT a.taskid) from (select a.* from insborder a INNER JOIN insborderpayment b on b.orderid = a.id
		<where>
			a.paymentstatus<![CDATA[ <> ]]>'02' and  a.paymentmethod='51' and  b.paychannelid='51' 
			<if test="fromDateTime!=null and toDateTime!=null">
				and b.createtime between #{fromDateTime} and #{toDateTime}
			</if>
		</where>) a
	</select>
</mapper>